<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Data Management (for INF-2700): schema.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>schema.c</h1><a href="schema_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***********************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> * Schema for assignments in the Databases course INF-2700 *</span>
<a name="l00003"></a>00003 <span class="comment"> * UIT - The Arctic University of Norway                   *</span>
<a name="l00004"></a>00004 <span class="comment"> * Author: Weihai Yu                                       *</span>
<a name="l00005"></a>00005 <span class="comment"> ************************************************************/</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#include &quot;<a class="code" href="schema_8h.html" title="Table schema.">schema.h</a>&quot;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &quot;<a class="code" href="pmsg_8h.html" title="Print a message to stderr when level is higher than the global msglevel.">pmsg.h</a>&quot;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00010"></a>00010 
<a name="l00012"></a><a class="code" href="structfield__desc__struct.html">00012</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_struct</a> {
<a name="l00013"></a><a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">00013</a>   <span class="keywordtype">char</span> *<a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">name</a>;       
<a name="l00014"></a><a class="code" href="structfield__desc__struct.html#a762a02070ab6ef49c1f79ffda1574b9a">00014</a>   <a class="code" href="schema_8h.html#af4e6ca114114786cc23f3d5a1f8d14bf">field_type</a> <a class="code" href="structfield__desc__struct.html#a762a02070ab6ef49c1f79ffda1574b9a">type</a>;  
<a name="l00015"></a><a class="code" href="structfield__desc__struct.html#aa39caeaf90adb277f79f0f3aba000359">00015</a>   <span class="keywordtype">int</span> <a class="code" href="structfield__desc__struct.html#aa39caeaf90adb277f79f0f3aba000359">len</a>;          
<a name="l00016"></a><a class="code" href="structfield__desc__struct.html#a496a2d85425c50e9f748a5cb974c68a6">00016</a>   <span class="keywordtype">int</span> <a class="code" href="structfield__desc__struct.html#a496a2d85425c50e9f748a5cb974c68a6">offset</a>;       
<a name="l00017"></a><a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">00017</a>   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> <a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>; 
<a name="l00018"></a>00018 } <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_struct</a>;
<a name="l00019"></a>00019 
<a name="l00024"></a><a class="code" href="structschema__struct.html">00024</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structschema__struct.html" title="Table/record schema.">schema_struct</a> {
<a name="l00025"></a><a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">00025</a>   <span class="keywordtype">char</span> *<a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">name</a>;     
<a name="l00026"></a><a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">00026</a>   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> <a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a>;   
<a name="l00027"></a><a class="code" href="structschema__struct.html#a2fc37d8c61c0d1e16fafded45dc0b5b1">00027</a>   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> <a class="code" href="structschema__struct.html#a2fc37d8c61c0d1e16fafded45dc0b5b1">last</a>;    
<a name="l00028"></a><a class="code" href="structschema__struct.html#ab666a6bb7024988fab74187d515b093b">00028</a>   <span class="keywordtype">int</span> <a class="code" href="structschema__struct.html#ab666a6bb7024988fab74187d515b093b">num_fields</a>; 
<a name="l00029"></a><a class="code" href="structschema__struct.html#a5aadf53e04e8e3231b15ac2465057ab4">00029</a>   <span class="keywordtype">int</span> <a class="code" href="structschema__struct.html#a5aadf53e04e8e3231b15ac2465057ab4">len</a>;        
<a name="l00030"></a><a class="code" href="structschema__struct.html#abaea04252495760a93d8d4a3386d0681">00030</a>   <a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a> <a class="code" href="structschema__struct.html#abaea04252495760a93d8d4a3386d0681">tbl</a>;          
<a name="l00031"></a>00031 } <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_struct</a>;
<a name="l00032"></a>00032 
<a name="l00037"></a><a class="code" href="structtbl__desc__struct.html">00037</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_desc_struct</a> {
<a name="l00038"></a><a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">00038</a>   <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> <a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">sch</a>;      
<a name="l00039"></a><a class="code" href="structtbl__desc__struct.html#a94e4b2edc45fb1c37e41de24fe494a4d">00039</a>   <span class="keywordtype">int</span> <a class="code" href="structtbl__desc__struct.html#a94e4b2edc45fb1c37e41de24fe494a4d">num_records</a>;   
<a name="l00040"></a><a class="code" href="structtbl__desc__struct.html#ab921d6fac328972ca0d1ff9289ec616c">00040</a>   <a class="code" href="structpage__struct.html" title="Database buffer page.">page_p</a> <a class="code" href="structtbl__desc__struct.html#ab921d6fac328972ca0d1ff9289ec616c">current_pg</a>; 
<a name="l00041"></a><a class="code" href="structtbl__desc__struct.html#ab72e52700926cecb45888d7e8b68b71c">00041</a>   <a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a> <a class="code" href="structtbl__desc__struct.html#ab72e52700926cecb45888d7e8b68b71c">next</a>;        
<a name="l00042"></a>00042 } <a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_desc_struct</a>;
<a name="l00043"></a>00043 
<a name="l00044"></a><a class="code" href="schema_8h.html#a4ff7df6edd236f96a6ba76a11dff3fe3">00044</a> <span class="keywordtype">void</span> <a class="code" href="schema_8c.html#a4ff7df6edd236f96a6ba76a11dff3fe3">put_field_info</a> ( <a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ad">pmsg_level</a> level, <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> f )
<a name="l00045"></a>00045 {
<a name="l00046"></a>00046   <span class="keywordflow">if</span> ( f == NULL )
<a name="l00047"></a>00047     {
<a name="l00048"></a>00048       <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (level,  <span class="stringliteral">&quot;  empty field\n&quot;</span>);
<a name="l00049"></a>00049       <span class="keywordflow">return</span>;
<a name="l00050"></a>00050     }   
<a name="l00051"></a>00051   <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (level, <span class="stringliteral">&quot;  \&quot;%s\&quot;, &quot;</span>, f-&gt;<a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">name</a>);
<a name="l00052"></a>00052   <span class="keywordflow">if</span> ( <a class="code" href="schema_8c.html#a8a501fb0eaf78f73ac37489694b95e0f">is_int_field</a> (f) )
<a name="l00053"></a>00053     <a class="code" href="pmsg_8c.html#a2657be20caeb09647f58943ff9df42ca" title="Appends additional info to the current message line.">append_msg</a> (level,  <span class="stringliteral">&quot;int &quot;</span>);
<a name="l00054"></a>00054   <span class="keywordflow">else</span>
<a name="l00055"></a>00055     <a class="code" href="pmsg_8c.html#a2657be20caeb09647f58943ff9df42ca" title="Appends additional info to the current message line.">append_msg</a> (level,  <span class="stringliteral">&quot;str &quot;</span>);
<a name="l00056"></a>00056   <a class="code" href="pmsg_8c.html#a2657be20caeb09647f58943ff9df42ca" title="Appends additional info to the current message line.">append_msg</a> (level, <span class="stringliteral">&quot;field, len: %d, offset: %d, &quot;</span>, f-&gt;<a class="code" href="structfield__desc__struct.html#aa39caeaf90adb277f79f0f3aba000359">len</a>, f-&gt;<a class="code" href="structfield__desc__struct.html#a496a2d85425c50e9f748a5cb974c68a6">offset</a>);
<a name="l00057"></a>00057   <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a> != NULL)
<a name="l00058"></a>00058     <a class="code" href="pmsg_8c.html#a2657be20caeb09647f58943ff9df42ca" title="Appends additional info to the current message line.">append_msg</a> (level,  <span class="stringliteral">&quot;, next field: %s\n&quot;</span>, f-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>-&gt;<a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">name</a>);
<a name="l00059"></a>00059   <span class="keywordflow">else</span>
<a name="l00060"></a>00060     <a class="code" href="pmsg_8c.html#a2657be20caeb09647f58943ff9df42ca" title="Appends additional info to the current message line.">append_msg</a> (level,  <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00061"></a>00061 }
<a name="l00062"></a>00062 
<a name="l00063"></a><a class="code" href="schema_8h.html#adc326d774f66892dbc519695ac236102">00063</a> <span class="keywordtype">void</span> <a class="code" href="schema_8c.html#adc326d774f66892dbc519695ac236102">put_schema_info</a> ( <a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ad">pmsg_level</a> level, <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s )
<a name="l00064"></a>00064 {
<a name="l00065"></a>00065   <span class="keywordflow">if</span> ( s == NULL )
<a name="l00066"></a>00066     {
<a name="l00067"></a>00067       <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (level,  <span class="stringliteral">&quot;--empty schema\n&quot;</span>);
<a name="l00068"></a>00068       <span class="keywordflow">return</span>;
<a name="l00069"></a>00069     }
<a name="l00070"></a>00070   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> f;
<a name="l00071"></a>00071   <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (level, <span class="stringliteral">&quot;--schema %s: %d field(s), totally %d bytes\n&quot;</span>,
<a name="l00072"></a>00072            s-&gt;<a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">name</a>, s-&gt;<a class="code" href="structschema__struct.html#ab666a6bb7024988fab74187d515b093b">num_fields</a>, s-&gt;<a class="code" href="structschema__struct.html#a5aadf53e04e8e3231b15ac2465057ab4">len</a>);
<a name="l00073"></a>00073   <span class="keywordflow">for</span> ( f = s-&gt;<a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a>; f != NULL; f = f-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>)
<a name="l00074"></a>00074     <a class="code" href="schema_8c.html#a4ff7df6edd236f96a6ba76a11dff3fe3">put_field_info</a> (level, f);
<a name="l00075"></a>00075   <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (level, <span class="stringliteral">&quot;--\n&quot;</span>);
<a name="l00076"></a>00076 }
<a name="l00077"></a>00077 
<a name="l00078"></a><a class="code" href="schema_8h.html#a8ad1caaeaa9408c196eb028a32bee9f5">00078</a> <span class="keywordtype">void</span> <a class="code" href="schema_8c.html#a8ad1caaeaa9408c196eb028a32bee9f5">put_tbl_info</a> ( <a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ad">pmsg_level</a> level, <a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a> t )
<a name="l00079"></a>00079 {
<a name="l00080"></a>00080   <span class="keywordflow">if</span> ( t == NULL )
<a name="l00081"></a>00081     {
<a name="l00082"></a>00082       <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (level,  <span class="stringliteral">&quot;--empty tbl desc\n&quot;</span>);
<a name="l00083"></a>00083       <span class="keywordflow">return</span>;
<a name="l00084"></a>00084     }
<a name="l00085"></a>00085   <a class="code" href="schema_8c.html#adc326d774f66892dbc519695ac236102">put_schema_info</a> (level, t-&gt;<a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">sch</a>);
<a name="l00086"></a>00086   <a class="code" href="pager_8c.html#aa1e03bea6f7cc9fe4647931bade28d3c">put_file_info</a> (level, t-&gt;<a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">sch</a>-&gt;<a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">name</a>);
<a name="l00087"></a>00087   <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (level, <span class="stringliteral">&quot;  %d records\n&quot;</span>, t-&gt;<a class="code" href="structtbl__desc__struct.html#a94e4b2edc45fb1c37e41de24fe494a4d">num_records</a>);
<a name="l00088"></a>00088   <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (level, <span class="stringliteral">&quot;----\n&quot;</span>);
<a name="l00089"></a>00089 }
<a name="l00090"></a>00090 
<a name="l00091"></a><a class="code" href="schema_8h.html#a444fc4fb5a7c13e99feb53df056c02ed">00091</a> <span class="keywordtype">void</span> <a class="code" href="schema_8c.html#a444fc4fb5a7c13e99feb53df056c02ed">put_record_info</a> ( <a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ad">pmsg_level</a> level, <a class="code" href="schema_8h.html#a5f79330712bfa8c414c6fe5192063108" title="Data record.">record</a> r, <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s )
<a name="l00092"></a>00092 {
<a name="l00093"></a>00093   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> f;
<a name="l00094"></a>00094   <span class="keywordtype">int</span> i = 0;
<a name="l00095"></a>00095   <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (level, <span class="stringliteral">&quot;Record: &quot;</span>);
<a name="l00096"></a>00096   <span class="keywordflow">for</span> ( f = s-&gt;<a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a>; f != NULL; f = f-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>, i++)
<a name="l00097"></a>00097     {
<a name="l00098"></a>00098       <span class="keywordflow">if</span> ( <a class="code" href="schema_8c.html#a8a501fb0eaf78f73ac37489694b95e0f">is_int_field</a> (f) )
<a name="l00099"></a>00099         <a class="code" href="pmsg_8c.html#a2657be20caeb09647f58943ff9df42ca" title="Appends additional info to the current message line.">append_msg</a> (level,  <span class="stringliteral">&quot;%d&quot;</span>, *(<span class="keywordtype">int</span> *)r[i] );
<a name="l00100"></a>00100       <span class="keywordflow">else</span>
<a name="l00101"></a>00101         <a class="code" href="pmsg_8c.html#a2657be20caeb09647f58943ff9df42ca" title="Appends additional info to the current message line.">append_msg</a> (level,  <span class="stringliteral">&quot;%s&quot;</span>, (<span class="keywordtype">char</span> *)r[i] );
<a name="l00102"></a>00102                         
<a name="l00103"></a>00103       <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a> != NULL)
<a name="l00104"></a>00104         <a class="code" href="pmsg_8c.html#a2657be20caeb09647f58943ff9df42ca" title="Appends additional info to the current message line.">append_msg</a> (level,  <span class="stringliteral">&quot; | &quot;</span> );
<a name="l00105"></a>00105     }
<a name="l00106"></a>00106   <a class="code" href="pmsg_8c.html#a2657be20caeb09647f58943ff9df42ca" title="Appends additional info to the current message line.">append_msg</a> (level,  <span class="stringliteral">&quot;\n&quot;</span> );
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 
<a name="l00109"></a><a class="code" href="schema_8h.html#a7fe87f6656cd7292d8ebb7b863a77bf7">00109</a> <span class="keywordtype">void</span> <a class="code" href="schema_8c.html#a7fe87f6656cd7292d8ebb7b863a77bf7">put_db_info</a> ( <a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ad">pmsg_level</a> level )
<a name="l00110"></a>00110 {
<a name="l00111"></a>00111   <span class="keywordtype">char</span> *db_dir = <a class="code" href="pager_8c.html#ad2d7b5713fe117690d7f612a6eedcdfa">system_dir</a> ();
<a name="l00112"></a>00112   <span class="keywordflow">if</span> (db_dir == NULL) <span class="keywordflow">return</span>;
<a name="l00113"></a>00113   <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (level, <span class="stringliteral">&quot;======Database at %s:\n&quot;</span>, db_dir);
<a name="l00114"></a>00114   <a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a> tbl;
<a name="l00115"></a>00115   <span class="keywordflow">for</span> (tbl = <a class="code" href="schema_8h.html#a1222bfad80513affb67128ee4433194f" title="Database tables.">db_tables</a>; tbl != NULL; tbl = tbl-&gt;<a class="code" href="structtbl__desc__struct.html#ab72e52700926cecb45888d7e8b68b71c">next</a>)
<a name="l00116"></a>00116     <a class="code" href="schema_8c.html#a8ad1caaeaa9408c196eb028a32bee9f5">put_tbl_info</a> (level, tbl);
<a name="l00117"></a>00117   <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (level, <span class="stringliteral">&quot;======\n&quot;</span>);
<a name="l00118"></a>00118 }
<a name="l00119"></a>00119 
<a name="l00120"></a><a class="code" href="schema_8h.html#ac8ebdde5c6612fb2c24eff45b7556131">00120</a> <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> <a class="code" href="schema_8c.html#ac8ebdde5c6612fb2c24eff45b7556131">new_int_field</a> ( <span class="keyword">const</span> <span class="keywordtype">char</span> *name )
<a name="l00121"></a>00121 {
<a name="l00122"></a>00122   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> res = (<a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a>) malloc (<span class="keyword">sizeof</span> (<a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_struct</a>));
<a name="l00123"></a>00123   res-&gt;<a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">name</a> = (<span class="keywordtype">char</span> *) malloc (strlen (name) + 1);
<a name="l00124"></a>00124   strcpy (res-&gt;<a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">name</a>, name);
<a name="l00125"></a>00125   res-&gt;<a class="code" href="structfield__desc__struct.html#a762a02070ab6ef49c1f79ffda1574b9a">type</a> = <a class="code" href="schema_8h.html#af4e6ca114114786cc23f3d5a1f8d14bfa7fee88532b24b79bf2a88688a5d681d7">INT_TYPE</a>;
<a name="l00126"></a>00126   res-&gt;<a class="code" href="structfield__desc__struct.html#aa39caeaf90adb277f79f0f3aba000359">len</a> = <a class="code" href="pager_8h.html#a3ac36dd0f02f263e5966ac1d1ecbd1bd">INT_SIZE</a>;
<a name="l00127"></a>00127   res-&gt;<a class="code" href="structfield__desc__struct.html#a496a2d85425c50e9f748a5cb974c68a6">offset</a> = 0;
<a name="l00128"></a>00128   res-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a> = NULL;
<a name="l00129"></a>00129   <span class="keywordflow">return</span> res;
<a name="l00130"></a>00130 }
<a name="l00131"></a>00131 
<a name="l00132"></a><a class="code" href="schema_8h.html#a25a7ae02eb22016437a652dac3e9e721">00132</a> <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> <a class="code" href="schema_8c.html#a25a7ae02eb22016437a652dac3e9e721">new_str_field</a> ( <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> len )
<a name="l00133"></a>00133 {
<a name="l00134"></a>00134   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> res = (<a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a>) malloc (<span class="keyword">sizeof</span> (<a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_struct</a>));
<a name="l00135"></a>00135   res-&gt;<a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">name</a> = malloc (strlen (name) + 1);
<a name="l00136"></a>00136   strcpy (res-&gt;<a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">name</a>, name);
<a name="l00137"></a>00137   res-&gt;<a class="code" href="structfield__desc__struct.html#a762a02070ab6ef49c1f79ffda1574b9a">type</a> = <a class="code" href="schema_8h.html#af4e6ca114114786cc23f3d5a1f8d14bfa893e9dbcc12316439b53aaa0091a1b13">STR_TYPE</a>;
<a name="l00138"></a>00138   res-&gt;<a class="code" href="structfield__desc__struct.html#aa39caeaf90adb277f79f0f3aba000359">len</a> = len;
<a name="l00139"></a>00139   res-&gt;<a class="code" href="structfield__desc__struct.html#a496a2d85425c50e9f748a5cb974c68a6">offset</a> = 0;
<a name="l00140"></a>00140   res-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a> = NULL;
<a name="l00141"></a>00141   <span class="keywordflow">return</span> res;
<a name="l00142"></a>00142 }
<a name="l00143"></a>00143 
<a name="l00144"></a>00144 <span class="keyword">static</span> <span class="keywordtype">void</span> release_field_desc ( <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> f )
<a name="l00145"></a>00145 {
<a name="l00146"></a>00146   <span class="keywordflow">if</span> (f == NULL)
<a name="l00147"></a>00147     <span class="keywordflow">return</span>;
<a name="l00148"></a>00148   free (f-&gt;<a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">name</a>);
<a name="l00149"></a>00149   free (f);
<a name="l00150"></a>00150 }
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 
<a name="l00153"></a><a class="code" href="schema_8h.html#a8a501fb0eaf78f73ac37489694b95e0f">00153</a> <span class="keywordtype">int</span> <a class="code" href="schema_8c.html#a8a501fb0eaf78f73ac37489694b95e0f">is_int_field</a> ( <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> f )
<a name="l00154"></a>00154 {
<a name="l00155"></a>00155   <span class="keywordflow">if</span> ( f == NULL)
<a name="l00156"></a>00156     <span class="keywordflow">return</span> 0;
<a name="l00157"></a>00157   <span class="keywordflow">return</span> (f-&gt;<a class="code" href="structfield__desc__struct.html#a762a02070ab6ef49c1f79ffda1574b9a">type</a> == <a class="code" href="schema_8h.html#af4e6ca114114786cc23f3d5a1f8d14bfa7fee88532b24b79bf2a88688a5d681d7">INT_TYPE</a>);
<a name="l00158"></a>00158 }
<a name="l00159"></a>00159 
<a name="l00160"></a><a class="code" href="schema_8h.html#ac44757896fce0b91467aef6a9294467f">00160</a> <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> <a class="code" href="schema_8c.html#ac44757896fce0b91467aef6a9294467f">field_desc_next</a> ( <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> f )
<a name="l00161"></a>00161 {
<a name="l00162"></a>00162   <span class="keywordflow">if</span> ( f == NULL )
<a name="l00163"></a>00163     {
<a name="l00164"></a>00164       <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2fd6f336d08340583bd620a7f5694c90">ERROR</a>, <span class="stringliteral">&quot;field_desc_next: NULL field_desc_next.\n&quot;</span>);
<a name="l00165"></a>00165       <span class="keywordflow">return</span> NULL;
<a name="l00166"></a>00166     }
<a name="l00167"></a>00167   <span class="keywordflow">return</span> f-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>;
<a name="l00168"></a>00168 }
<a name="l00169"></a>00169 
<a name="l00170"></a>00170 <span class="keyword">static</span> <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> make_schema ( <span class="keyword">const</span> <span class="keywordtype">char</span> *name )
<a name="l00171"></a>00171 {
<a name="l00172"></a>00172   <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> res = (<a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a>) malloc (<span class="keyword">sizeof</span> (<a class="code" href="structschema__struct.html" title="Table/record schema.">schema_struct</a>));
<a name="l00173"></a>00173   res-&gt;<a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">name</a> = (<span class="keywordtype">char</span> *) malloc (strlen (name) + 1);
<a name="l00174"></a>00174   strcpy (res-&gt;<a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">name</a>, name);
<a name="l00175"></a>00175   res-&gt;<a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a> = NULL;
<a name="l00176"></a>00176   res-&gt;<a class="code" href="structschema__struct.html#a2fc37d8c61c0d1e16fafded45dc0b5b1">last</a> = NULL;
<a name="l00177"></a>00177   res-&gt;<a class="code" href="structschema__struct.html#ab666a6bb7024988fab74187d515b093b">num_fields</a> = 0;
<a name="l00178"></a>00178   res-&gt;<a class="code" href="structschema__struct.html#a5aadf53e04e8e3231b15ac2465057ab4">len</a> = 0;
<a name="l00179"></a>00179   <span class="keywordflow">return</span> res;
<a name="l00180"></a>00180 }
<a name="l00181"></a>00181 
<a name="l00183"></a>00183 <span class="keyword">static</span> <span class="keywordtype">void</span> release_schema ( <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> sch )
<a name="l00184"></a>00184 {
<a name="l00185"></a>00185   <span class="keywordflow">if</span> ( sch == NULL )
<a name="l00186"></a>00186     <span class="keywordflow">return</span>;
<a name="l00187"></a>00187   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> f, nextf;
<a name="l00188"></a>00188   f = sch-&gt;<a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a>;
<a name="l00189"></a>00189   <span class="keywordflow">while</span> (f != NULL)
<a name="l00190"></a>00190     {
<a name="l00191"></a>00191       nextf = f-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>;
<a name="l00192"></a>00192       release_field_desc (f);
<a name="l00193"></a>00193       f = nextf;
<a name="l00194"></a>00194     }
<a name="l00195"></a>00195   free (sch-&gt;<a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">name</a>);
<a name="l00196"></a>00196   free (sch);
<a name="l00197"></a>00197 }
<a name="l00198"></a>00198 
<a name="l00199"></a><a class="code" href="schema_8h.html#a306cf263ad7688f8180a95bbcfcf4972">00199</a> <span class="keywordtype">char</span>* <a class="code" href="schema_8c.html#a306cf263ad7688f8180a95bbcfcf4972">schema_name</a> ( <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> sch )
<a name="l00200"></a>00200 {
<a name="l00201"></a>00201   <span class="keywordflow">if</span> ( sch == NULL )
<a name="l00202"></a>00202     {
<a name="l00203"></a>00203       <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2fd6f336d08340583bd620a7f5694c90">ERROR</a>, <span class="stringliteral">&quot;schema_name: NULL schema.\n&quot;</span>);
<a name="l00204"></a>00204       <span class="keywordflow">return</span> NULL;
<a name="l00205"></a>00205     }
<a name="l00206"></a>00206   <span class="keywordflow">return</span> sch-&gt;<a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">name</a>;
<a name="l00207"></a>00207 }
<a name="l00208"></a>00208 
<a name="l00209"></a><a class="code" href="schema_8h.html#abd95953ab3dc200347c0f9c7fc30ab93">00209</a> <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> <a class="code" href="schema_8c.html#abd95953ab3dc200347c0f9c7fc30ab93">schema_first_fld_desc</a> ( <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> sch )
<a name="l00210"></a>00210 {
<a name="l00211"></a>00211   <span class="keywordflow">if</span> ( sch == NULL )
<a name="l00212"></a>00212     {
<a name="l00213"></a>00213       <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2fd6f336d08340583bd620a7f5694c90">ERROR</a>, <span class="stringliteral">&quot;schema_first_fld_desc: NULL schema.\n&quot;</span>);
<a name="l00214"></a>00214       <span class="keywordflow">return</span> NULL;
<a name="l00215"></a>00215     }
<a name="l00216"></a>00216   <span class="keywordflow">return</span> sch-&gt;<a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a>;
<a name="l00217"></a>00217 }
<a name="l00218"></a>00218 
<a name="l00219"></a><a class="code" href="schema_8h.html#afc7a64b2158f9121d2626f3fdc66a3af">00219</a> <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> <a class="code" href="schema_8c.html#afc7a64b2158f9121d2626f3fdc66a3af">schema_last_fld_desc</a> ( <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> sch )
<a name="l00220"></a>00220 {
<a name="l00221"></a>00221   <span class="keywordflow">if</span> ( sch == NULL )
<a name="l00222"></a>00222     {
<a name="l00223"></a>00223       <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2fd6f336d08340583bd620a7f5694c90">ERROR</a>, <span class="stringliteral">&quot;schema_last_fld_desc: NULL schema.\n&quot;</span>);
<a name="l00224"></a>00224       <span class="keywordflow">return</span> NULL;
<a name="l00225"></a>00225     }
<a name="l00226"></a>00226   <span class="keywordflow">return</span> sch-&gt;<a class="code" href="structschema__struct.html#a2fc37d8c61c0d1e16fafded45dc0b5b1">last</a>;
<a name="l00227"></a>00227 }
<a name="l00228"></a>00228 
<a name="l00229"></a><a class="code" href="schema_8h.html#a654f55baae305752c1b9b30092bc3540">00229</a> <span class="keywordtype">int</span> <a class="code" href="schema_8c.html#a654f55baae305752c1b9b30092bc3540">schema_num_flds</a> ( <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> sch )
<a name="l00230"></a>00230 {
<a name="l00231"></a>00231   <span class="keywordflow">if</span> ( sch == NULL )
<a name="l00232"></a>00232     {
<a name="l00233"></a>00233       <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2fd6f336d08340583bd620a7f5694c90">ERROR</a>, <span class="stringliteral">&quot;schema_num_flds: NULL schema.\n&quot;</span>);
<a name="l00234"></a>00234       <span class="keywordflow">return</span> -1;
<a name="l00235"></a>00235     }
<a name="l00236"></a>00236   <span class="keywordflow">return</span> sch-&gt;<a class="code" href="structschema__struct.html#ab666a6bb7024988fab74187d515b093b">num_fields</a>;
<a name="l00237"></a>00237 }
<a name="l00238"></a>00238 
<a name="l00239"></a><a class="code" href="schema_8h.html#a60a8389c4c46c8b18dc563624f311300">00239</a> <span class="keywordtype">int</span> <a class="code" href="schema_8c.html#a60a8389c4c46c8b18dc563624f311300">schema_len</a> ( <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> sch )
<a name="l00240"></a>00240 {
<a name="l00241"></a>00241   <span class="keywordflow">if</span> ( sch == NULL )
<a name="l00242"></a>00242     {
<a name="l00243"></a>00243       <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2fd6f336d08340583bd620a7f5694c90">ERROR</a>, <span class="stringliteral">&quot;schema_len: NULL schema.\n&quot;</span>);
<a name="l00244"></a>00244       <span class="keywordflow">return</span> -1;
<a name="l00245"></a>00245     }
<a name="l00246"></a>00246   <span class="keywordflow">return</span> sch-&gt;<a class="code" href="structschema__struct.html#a5aadf53e04e8e3231b15ac2465057ab4">len</a>;
<a name="l00247"></a>00247 }
<a name="l00248"></a>00248 
<a name="l00249"></a><a class="code" href="schema_8c.html#ad7593f210a3dc0b8fb524558c6b79ed9">00249</a> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="schema_8c.html#ad7593f210a3dc0b8fb524558c6b79ed9">tables_desc_file</a>[] = <span class="stringliteral">&quot;db.db&quot;</span>;
<a name="l00250"></a>00250 
<a name="l00251"></a>00251 <span class="keyword">static</span> <span class="keywordtype">void</span> save_tbl_desc ( FILE *fp, <a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a> tbl )
<a name="l00252"></a>00252 {
<a name="l00253"></a>00253   <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> sch = tbl-&gt;<a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">sch</a>;
<a name="l00254"></a>00254   fprintf ( fp, <span class="stringliteral">&quot;%s %d\n&quot;</span>, sch-&gt;<a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">name</a>, sch-&gt;<a class="code" href="structschema__struct.html#ab666a6bb7024988fab74187d515b093b">num_fields</a> );
<a name="l00255"></a>00255   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> fld = <a class="code" href="schema_8c.html#abd95953ab3dc200347c0f9c7fc30ab93">schema_first_fld_desc</a> ( sch );
<a name="l00256"></a>00256   <span class="keywordflow">while</span> ( fld != NULL )
<a name="l00257"></a>00257     {
<a name="l00258"></a>00258       fprintf (fp, <span class="stringliteral">&quot;%s %d %d %d\n&quot;</span>,
<a name="l00259"></a>00259                fld-&gt;<a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">name</a>, fld-&gt;<a class="code" href="structfield__desc__struct.html#a762a02070ab6ef49c1f79ffda1574b9a">type</a>, fld-&gt;<a class="code" href="structfield__desc__struct.html#aa39caeaf90adb277f79f0f3aba000359">len</a>, fld-&gt;<a class="code" href="structfield__desc__struct.html#a496a2d85425c50e9f748a5cb974c68a6">offset</a>);
<a name="l00260"></a>00260       fld = fld-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>;
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262   fprintf (fp, <span class="stringliteral">&quot;%d\n&quot;</span>, tbl-&gt;<a class="code" href="structtbl__desc__struct.html#a94e4b2edc45fb1c37e41de24fe494a4d">num_records</a>);
<a name="l00263"></a>00263 }
<a name="l00264"></a>00264 
<a name="l00265"></a>00265 <span class="keyword">static</span> <span class="keywordtype">void</span> save_tbl_descs ()
<a name="l00266"></a>00266 {
<a name="l00267"></a>00267   <a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a> tbl = <a class="code" href="schema_8h.html#a1222bfad80513affb67128ee4433194f" title="Database tables.">db_tables</a>, next_tbl = NULL;
<a name="l00268"></a>00268   <span class="keywordtype">char</span> tbl_desc_backup[30] = <span class="stringliteral">&quot;__&quot;</span>;
<a name="l00269"></a>00269   rename ( tables_desc_file, strcat (tbl_desc_backup, tables_desc_file));
<a name="l00270"></a>00270   FILE *dbfile = fopen (tables_desc_file, <span class="stringliteral">&quot;w+&quot;</span>);
<a name="l00271"></a>00271   <span class="keywordflow">while</span> (tbl)
<a name="l00272"></a>00272     {
<a name="l00273"></a>00273       save_tbl_desc ( dbfile, tbl);
<a name="l00274"></a>00274       release_schema (tbl-&gt;<a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">sch</a>);
<a name="l00275"></a>00275       next_tbl = tbl-&gt;<a class="code" href="structtbl__desc__struct.html#ab72e52700926cecb45888d7e8b68b71c">next</a>;
<a name="l00276"></a>00276       free (tbl);
<a name="l00277"></a>00277       tbl = next_tbl;
<a name="l00278"></a>00278     }
<a name="l00279"></a>00279   fclose (dbfile);
<a name="l00280"></a>00280 }
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 <span class="keyword">static</span> <span class="keywordtype">void</span> read_tbl_descs ()
<a name="l00283"></a>00283 {
<a name="l00284"></a>00284   
<a name="l00285"></a>00285   FILE *fp = fopen (tables_desc_file, <span class="stringliteral">&quot;r&quot;</span>);
<a name="l00286"></a>00286   <span class="keywordflow">if</span> ( fp == NULL ) <span class="keywordflow">return</span>;
<a name="l00287"></a>00287   <span class="keywordtype">char</span> name[30] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00288"></a>00288   <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> sch;
<a name="l00289"></a>00289   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> fld;
<a name="l00290"></a>00290   <span class="keywordtype">int</span> num_flds = 0, fld_type, fld_len;
<a name="l00291"></a>00291   <span class="keywordflow">while</span> ( !feof(fp) )
<a name="l00292"></a>00292     {
<a name="l00293"></a>00293       <span class="keywordflow">if</span> ( fscanf ( fp, <span class="stringliteral">&quot;%s %d\n&quot;</span>, name, &amp;num_flds ) &lt; 2 )
<a name="l00294"></a>00294         {
<a name="l00295"></a>00295           fclose (fp);
<a name="l00296"></a>00296           <span class="keywordflow">return</span>;
<a name="l00297"></a>00297         }
<a name="l00298"></a>00298       sch = <a class="code" href="schema_8c.html#a5b1a8d21a78e52a9c0780121ecf3703c">new_schema</a> ( name );
<a name="l00299"></a>00299       <span class="keywordtype">int</span> i;
<a name="l00300"></a>00300       <span class="keywordflow">for</span> (i = 0; i &lt; num_flds; i++ )
<a name="l00301"></a>00301         {
<a name="l00302"></a>00302           fscanf ( fp, <span class="stringliteral">&quot;%s %d %d&quot;</span>, name, &amp;(fld_type), &amp;(fld_len) );
<a name="l00303"></a>00303           <span class="keywordflow">switch</span> (fld_type) {
<a name="l00304"></a>00304           <span class="keywordflow">case</span> <a class="code" href="schema_8h.html#af4e6ca114114786cc23f3d5a1f8d14bfa7fee88532b24b79bf2a88688a5d681d7">INT_TYPE</a>:
<a name="l00305"></a>00305             fld = <a class="code" href="schema_8c.html#ac8ebdde5c6612fb2c24eff45b7556131">new_int_field</a> ( name );
<a name="l00306"></a>00306             <span class="keywordflow">break</span>;
<a name="l00307"></a>00307           <span class="keywordflow">case</span> <a class="code" href="schema_8h.html#af4e6ca114114786cc23f3d5a1f8d14bfa893e9dbcc12316439b53aaa0091a1b13">STR_TYPE</a>:
<a name="l00308"></a>00308             fld = <a class="code" href="schema_8c.html#a25a7ae02eb22016437a652dac3e9e721">new_str_field</a> ( name, fld_len );
<a name="l00309"></a>00309             <span class="keywordflow">break</span>;
<a name="l00310"></a>00310           }
<a name="l00311"></a>00311           fscanf (fp, <span class="stringliteral">&quot;%d\n&quot;</span>, &amp;(fld-&gt;<a class="code" href="structfield__desc__struct.html#a496a2d85425c50e9f748a5cb974c68a6">offset</a>));
<a name="l00312"></a>00312           <a class="code" href="schema_8c.html#a7dec693aa250f212822edfb6488446cd">add_field</a> ( sch, fld );
<a name="l00313"></a>00313         }
<a name="l00314"></a>00314       fscanf ( fp, <span class="stringliteral">&quot;%d\n&quot;</span>,  &amp;(sch-&gt;<a class="code" href="structschema__struct.html#abaea04252495760a93d8d4a3386d0681">tbl</a>-&gt;<a class="code" href="structtbl__desc__struct.html#a94e4b2edc45fb1c37e41de24fe494a4d">num_records</a>)  );
<a name="l00315"></a>00315     }
<a name="l00316"></a>00316   <a class="code" href="schema_8h.html#a1222bfad80513affb67128ee4433194f" title="Database tables.">db_tables</a> = sch-&gt;<a class="code" href="structschema__struct.html#abaea04252495760a93d8d4a3386d0681">tbl</a>;
<a name="l00317"></a>00317   fclose (fp);
<a name="l00318"></a>00318 }
<a name="l00319"></a>00319 
<a name="l00320"></a><a class="code" href="schema_8h.html#ac5bd6b6b917bf424de25fd8f257fe061">00320</a> <span class="keywordtype">int</span> <a class="code" href="schema_8c.html#ac5bd6b6b917bf424de25fd8f257fe061">open_db</a> ( <span class="keywordtype">void</span> )
<a name="l00321"></a>00321 {
<a name="l00322"></a>00322   <a class="code" href="pager_8c.html#a52d442ae882695568880d1f6a064c220">pager_terminate</a> (); <span class="comment">/* first clean up for a fresh start */</span>
<a name="l00323"></a>00323   <a class="code" href="pager_8c.html#a75f76fe5fe3b92e3536f5123dd4db10d">pager_init</a> ();
<a name="l00324"></a>00324   read_tbl_descs ();
<a name="l00325"></a>00325   <span class="keywordflow">return</span> 0;
<a name="l00326"></a>00326 }
<a name="l00327"></a>00327 
<a name="l00328"></a><a class="code" href="schema_8h.html#a69a49703885b4713a672943874e121ab">00328</a> <span class="keywordtype">void</span> <a class="code" href="schema_8c.html#a69a49703885b4713a672943874e121ab">close_db</a> ( <span class="keywordtype">void</span> )
<a name="l00329"></a>00329 { 
<a name="l00330"></a>00330   save_tbl_descs ();
<a name="l00331"></a>00331   <a class="code" href="schema_8h.html#a1222bfad80513affb67128ee4433194f" title="Database tables.">db_tables</a> = NULL;
<a name="l00332"></a>00332   <a class="code" href="pager_8c.html#a52d442ae882695568880d1f6a064c220">pager_terminate</a> ();
<a name="l00333"></a>00333 }
<a name="l00334"></a>00334 
<a name="l00335"></a><a class="code" href="schema_8h.html#a5b1a8d21a78e52a9c0780121ecf3703c">00335</a> <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> <a class="code" href="schema_8c.html#a5b1a8d21a78e52a9c0780121ecf3703c">new_schema</a> ( <span class="keyword">const</span> <span class="keywordtype">char</span> *name )
<a name="l00336"></a>00336 {
<a name="l00337"></a>00337   <a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a> tbl = (<a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a>) malloc (<span class="keyword">sizeof</span> (<a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_desc_struct</a>));
<a name="l00338"></a>00338   tbl-&gt;<a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">sch</a> = make_schema ( name );
<a name="l00339"></a>00339   tbl-&gt;<a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">sch</a>-&gt;<a class="code" href="structschema__struct.html#abaea04252495760a93d8d4a3386d0681">tbl</a> = tbl;
<a name="l00340"></a>00340   tbl-&gt;<a class="code" href="structtbl__desc__struct.html#a94e4b2edc45fb1c37e41de24fe494a4d">num_records</a> = 0;
<a name="l00341"></a>00341   tbl-&gt;<a class="code" href="structtbl__desc__struct.html#ab921d6fac328972ca0d1ff9289ec616c">current_pg</a> = NULL;
<a name="l00342"></a>00342   tbl-&gt;<a class="code" href="structtbl__desc__struct.html#ab72e52700926cecb45888d7e8b68b71c">next</a> = <a class="code" href="schema_8h.html#a1222bfad80513affb67128ee4433194f" title="Database tables.">db_tables</a>;
<a name="l00343"></a>00343   <a class="code" href="schema_8h.html#a1222bfad80513affb67128ee4433194f" title="Database tables.">db_tables</a> = tbl;
<a name="l00344"></a>00344   <span class="keywordflow">return</span> tbl-&gt;<a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">sch</a>;
<a name="l00345"></a>00345 }
<a name="l00346"></a>00346 
<a name="l00347"></a><a class="code" href="schema_8h.html#a7787929d1394f428c37aa5279c190d46">00347</a> <a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a> <a class="code" href="schema_8c.html#a7787929d1394f428c37aa5279c190d46">get_table</a> ( <span class="keyword">const</span> <span class="keywordtype">char</span> *name )
<a name="l00348"></a>00348 {
<a name="l00349"></a>00349   <a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a> tbl;
<a name="l00350"></a>00350   <span class="keywordflow">for</span> (tbl = <a class="code" href="schema_8h.html#a1222bfad80513affb67128ee4433194f" title="Database tables.">db_tables</a>; tbl != NULL; tbl = tbl-&gt;<a class="code" href="structtbl__desc__struct.html#ab72e52700926cecb45888d7e8b68b71c">next</a>)
<a name="l00351"></a>00351     <span class="keywordflow">if</span> ( strcmp (name, tbl-&gt;<a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">sch</a>-&gt;<a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">name</a>) == 0 )
<a name="l00352"></a>00352       <span class="keywordflow">return</span> tbl;
<a name="l00353"></a>00353   <span class="keywordflow">return</span> NULL;
<a name="l00354"></a>00354 }
<a name="l00355"></a>00355 
<a name="l00356"></a><a class="code" href="schema_8h.html#a7659f0c43f283f9d0b7cd3c18c3293f5">00356</a> <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> <a class="code" href="schema_8c.html#a7659f0c43f283f9d0b7cd3c18c3293f5">get_schema</a> ( <span class="keyword">const</span> <span class="keywordtype">char</span> *name )
<a name="l00357"></a>00357 {
<a name="l00358"></a>00358   <a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a> tbl = <a class="code" href="schema_8c.html#a7787929d1394f428c37aa5279c190d46">get_table</a> ( name );
<a name="l00359"></a>00359   <span class="keywordflow">if</span> ( tbl == NULL)
<a name="l00360"></a>00360     <span class="keywordflow">return</span> NULL;
<a name="l00361"></a>00361   <span class="keywordflow">else</span>
<a name="l00362"></a>00362     <span class="keywordflow">return</span> tbl-&gt;<a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">sch</a>;
<a name="l00363"></a>00363 }
<a name="l00364"></a>00364 
<a name="l00365"></a><a class="code" href="schema_8h.html#ac45d975882ff178fb8a1c98b5bf31c2e">00365</a> <span class="keywordtype">void</span> <a class="code" href="schema_8c.html#ac45d975882ff178fb8a1c98b5bf31c2e">remove_table</a> ( <a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a> t )
<a name="l00366"></a>00366 {
<a name="l00367"></a>00367   <span class="keywordflow">if</span> (t == NULL) <span class="keywordflow">return</span>;
<a name="l00368"></a>00368 
<a name="l00369"></a>00369   <a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a> tbl, prev = NULL;
<a name="l00370"></a>00370   <span class="keywordflow">for</span> (tbl = <a class="code" href="schema_8h.html#a1222bfad80513affb67128ee4433194f" title="Database tables.">db_tables</a>; tbl != NULL; prev = tbl, tbl = tbl-&gt;<a class="code" href="structtbl__desc__struct.html#ab72e52700926cecb45888d7e8b68b71c">next</a>)
<a name="l00371"></a>00371     <span class="keywordflow">if</span> ( tbl == t )
<a name="l00372"></a>00372       {
<a name="l00373"></a>00373         <span class="keywordflow">if</span> (t == <a class="code" href="schema_8h.html#a1222bfad80513affb67128ee4433194f" title="Database tables.">db_tables</a>)
<a name="l00374"></a>00374           <a class="code" href="schema_8h.html#a1222bfad80513affb67128ee4433194f" title="Database tables.">db_tables</a> = t-&gt;<a class="code" href="structtbl__desc__struct.html#ab72e52700926cecb45888d7e8b68b71c">next</a>;
<a name="l00375"></a>00375         <span class="keywordflow">else</span>
<a name="l00376"></a>00376           prev-&gt;<a class="code" href="structtbl__desc__struct.html#ab72e52700926cecb45888d7e8b68b71c">next</a> = t-&gt;<a class="code" href="structtbl__desc__struct.html#ab72e52700926cecb45888d7e8b68b71c">next</a>;
<a name="l00377"></a>00377         <a class="code" href="pager_8c.html#aa5341cc5ee73400407087181f229a163">close_file</a> (t-&gt;<a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">sch</a>-&gt;<a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">name</a>);
<a name="l00378"></a>00378         <span class="keywordtype">char</span> tbl_backup[30] = <span class="stringliteral">&quot;__&quot;</span>;
<a name="l00379"></a>00379         rename ( t-&gt;<a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">sch</a>-&gt;<a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">name</a>, strcat (tbl_backup, t-&gt;<a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">sch</a>-&gt;<a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">name</a>) );
<a name="l00380"></a>00380         release_schema (t-&gt;<a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">sch</a>);
<a name="l00381"></a>00381         free (t);
<a name="l00382"></a>00382         <span class="keywordflow">return</span>;
<a name="l00383"></a>00383       }
<a name="l00384"></a>00384 }
<a name="l00385"></a>00385 
<a name="l00386"></a><a class="code" href="schema_8h.html#a2913f8a4ccb89ef7c75b22af80bb7af9">00386</a> <span class="keywordtype">void</span> <a class="code" href="schema_8c.html#a2913f8a4ccb89ef7c75b22af80bb7af9">remove_schema</a> ( <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s )
<a name="l00387"></a>00387 {
<a name="l00388"></a>00388   <span class="keywordflow">if</span> (s == NULL) <span class="keywordflow">return</span>;
<a name="l00389"></a>00389   <a class="code" href="schema_8c.html#ac45d975882ff178fb8a1c98b5bf31c2e">remove_table</a> (s-&gt;<a class="code" href="structschema__struct.html#abaea04252495760a93d8d4a3386d0681">tbl</a>);
<a name="l00390"></a>00390 }
<a name="l00391"></a>00391 
<a name="l00392"></a>00392 <span class="keyword">static</span> <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> copy_field ( <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> f )
<a name="l00393"></a>00393 {
<a name="l00394"></a>00394   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> res = (<a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a>) malloc (<span class="keyword">sizeof</span> (<a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_struct</a>));
<a name="l00395"></a>00395   res-&gt;<a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">name</a> = (<span class="keywordtype">char</span> *) malloc (strlen (f-&gt;<a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">name</a>) + 1);
<a name="l00396"></a>00396   strcpy (res-&gt;<a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">name</a>, f-&gt;<a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">name</a>);
<a name="l00397"></a>00397   res-&gt;<a class="code" href="structfield__desc__struct.html#a762a02070ab6ef49c1f79ffda1574b9a">type</a> = f-&gt;<a class="code" href="structfield__desc__struct.html#a762a02070ab6ef49c1f79ffda1574b9a">type</a>;
<a name="l00398"></a>00398   res-&gt;<a class="code" href="structfield__desc__struct.html#aa39caeaf90adb277f79f0f3aba000359">len</a> = f-&gt;<a class="code" href="structfield__desc__struct.html#aa39caeaf90adb277f79f0f3aba000359">len</a>;
<a name="l00399"></a>00399   res-&gt;<a class="code" href="structfield__desc__struct.html#a496a2d85425c50e9f748a5cb974c68a6">offset</a> = 0;
<a name="l00400"></a>00400   res-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a> = NULL;
<a name="l00401"></a>00401   <span class="keywordflow">return</span> res;  
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 <span class="keyword">static</span> <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> copy_schema ( <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s, <span class="keyword">const</span> <span class="keywordtype">char</span> *dest_name )
<a name="l00405"></a>00405 {
<a name="l00406"></a>00406   <span class="keywordflow">if</span> (s == NULL ) <span class="keywordflow">return</span> NULL;
<a name="l00407"></a>00407   <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> dest = <a class="code" href="schema_8c.html#a5b1a8d21a78e52a9c0780121ecf3703c">new_schema</a> (dest_name);
<a name="l00408"></a>00408   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> f = s-&gt;<a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a>;
<a name="l00409"></a>00409   <span class="keywordflow">for</span> ( ; f != NULL; f = f-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>)
<a name="l00410"></a>00410     <a class="code" href="schema_8c.html#a7dec693aa250f212822edfb6488446cd">add_field</a> (dest, copy_field (f));
<a name="l00411"></a>00411   <span class="keywordflow">return</span> dest;
<a name="l00412"></a>00412 }
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 <span class="keyword">static</span> <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> get_field ( <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s, <span class="keywordtype">char</span> *name )
<a name="l00415"></a>00415 {
<a name="l00416"></a>00416   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> f = s-&gt;<a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a>;
<a name="l00417"></a>00417   <span class="keywordflow">for</span> ( ; f != NULL; f = f-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>)
<a name="l00418"></a>00418     <span class="keywordflow">if</span> ( strcmp ( f-&gt;<a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">name</a>, name ) == 0 ) <span class="keywordflow">return</span> f;
<a name="l00419"></a>00419   <span class="keywordflow">return</span> NULL;
<a name="l00420"></a>00420 }
<a name="l00421"></a>00421 
<a name="l00422"></a>00422 <span class="keyword">static</span> <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> make_sub_schema ( <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s, <span class="keyword">const</span> <span class="keywordtype">char</span> *dest_name,
<a name="l00423"></a>00423                                   <span class="keywordtype">int</span> num_fields, <span class="keywordtype">char</span> *fields[] )
<a name="l00424"></a>00424 {
<a name="l00425"></a>00425   <span class="keywordflow">if</span> (s == NULL ) <span class="keywordflow">return</span> NULL;
<a name="l00426"></a>00426   <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> dest = <a class="code" href="schema_8c.html#a5b1a8d21a78e52a9c0780121ecf3703c">new_schema</a> (dest_name);
<a name="l00427"></a>00427   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> f = NULL;
<a name="l00428"></a>00428   <span class="keywordtype">int</span> i = 0;
<a name="l00429"></a>00429   <span class="keywordflow">for</span> ( i= 0; i &lt; num_fields; i++)
<a name="l00430"></a>00430     {
<a name="l00431"></a>00431       f = get_field ( s, fields[i] );
<a name="l00432"></a>00432       <span class="keywordflow">if</span> ( f != NULL)
<a name="l00433"></a>00433         <a class="code" href="schema_8c.html#a7dec693aa250f212822edfb6488446cd">add_field</a> (dest, copy_field (f));
<a name="l00434"></a>00434       <span class="keywordflow">else</span>
<a name="l00435"></a>00435         {
<a name="l00436"></a>00436           <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2fd6f336d08340583bd620a7f5694c90">ERROR</a>, <span class="stringliteral">&quot;\&quot;%s\&quot; has no \&quot;%s\&quot; field\n&quot;</span>,
<a name="l00437"></a>00437                    s-&gt;<a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">name</a>, fields[i]);
<a name="l00438"></a>00438           <a class="code" href="schema_8c.html#a2913f8a4ccb89ef7c75b22af80bb7af9">remove_schema</a> (dest);
<a name="l00439"></a>00439           <span class="keywordflow">return</span> NULL;
<a name="l00440"></a>00440         }
<a name="l00441"></a>00441     }
<a name="l00442"></a>00442   <span class="keywordflow">return</span> dest;
<a name="l00443"></a>00443 }
<a name="l00444"></a>00444 
<a name="l00445"></a><a class="code" href="schema_8h.html#a7dec693aa250f212822edfb6488446cd">00445</a> <span class="keywordtype">int</span> <a class="code" href="schema_8c.html#a7dec693aa250f212822edfb6488446cd">add_field</a> ( <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s, <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> f )
<a name="l00446"></a>00446 {
<a name="l00447"></a>00447   <span class="keywordflow">if</span> ( s == NULL )
<a name="l00448"></a>00448     <span class="keywordflow">return</span> -1;
<a name="l00449"></a>00449   <span class="keywordflow">if</span> ( s-&gt;<a class="code" href="structschema__struct.html#a5aadf53e04e8e3231b15ac2465057ab4">len</a> + f-&gt;<a class="code" href="structfield__desc__struct.html#aa39caeaf90adb277f79f0f3aba000359">len</a> &gt; <a class="code" href="pager_8h.html#ad51ded0bbd705f02f73fc60c0b721ced">BLOCK_SIZE</a> - <a class="code" href="pager_8h.html#af11125b8a270a84314fdb616e19b11ec">PAGE_HEADER_SIZE</a> )
<a name="l00450"></a>00450     {
<a name="l00451"></a>00451       <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2fd6f336d08340583bd620a7f5694c90">ERROR</a>,
<a name="l00452"></a>00452                <span class="stringliteral">&quot;schema already has %d bytes, adding %d will exceed limited %d bytes.\n&quot;</span>,
<a name="l00453"></a>00453                s-&gt;<a class="code" href="structschema__struct.html#a5aadf53e04e8e3231b15ac2465057ab4">len</a>, f-&gt;<a class="code" href="structfield__desc__struct.html#aa39caeaf90adb277f79f0f3aba000359">len</a>, <a class="code" href="pager_8h.html#ad51ded0bbd705f02f73fc60c0b721ced">BLOCK_SIZE</a> - <a class="code" href="pager_8h.html#af11125b8a270a84314fdb616e19b11ec">PAGE_HEADER_SIZE</a>);
<a name="l00454"></a>00454       <span class="keywordflow">return</span> -1;
<a name="l00455"></a>00455     }
<a name="l00456"></a>00456   <span class="keywordflow">if</span> ( s-&gt;<a class="code" href="structschema__struct.html#ab666a6bb7024988fab74187d515b093b">num_fields</a> == 0)
<a name="l00457"></a>00457     {
<a name="l00458"></a>00458       s-&gt;<a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a> = f;
<a name="l00459"></a>00459       f-&gt;<a class="code" href="structfield__desc__struct.html#a496a2d85425c50e9f748a5cb974c68a6">offset</a> = 0;
<a name="l00460"></a>00460     }
<a name="l00461"></a>00461   <span class="keywordflow">else</span>
<a name="l00462"></a>00462     {
<a name="l00463"></a>00463       s-&gt;<a class="code" href="structschema__struct.html#a2fc37d8c61c0d1e16fafded45dc0b5b1">last</a>-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a> = f;
<a name="l00464"></a>00464       f-&gt;<a class="code" href="structfield__desc__struct.html#a496a2d85425c50e9f748a5cb974c68a6">offset</a> = s-&gt;<a class="code" href="structschema__struct.html#a5aadf53e04e8e3231b15ac2465057ab4">len</a>;
<a name="l00465"></a>00465     }
<a name="l00466"></a>00466   s-&gt;<a class="code" href="structschema__struct.html#a2fc37d8c61c0d1e16fafded45dc0b5b1">last</a> = f;
<a name="l00467"></a>00467   s-&gt;<a class="code" href="structschema__struct.html#ab666a6bb7024988fab74187d515b093b">num_fields</a>++;
<a name="l00468"></a>00468   s-&gt;<a class="code" href="structschema__struct.html#a5aadf53e04e8e3231b15ac2465057ab4">len</a> += f-&gt;<a class="code" href="structfield__desc__struct.html#aa39caeaf90adb277f79f0f3aba000359">len</a>;
<a name="l00469"></a>00469   <span class="keywordflow">return</span> s-&gt;<a class="code" href="structschema__struct.html#ab666a6bb7024988fab74187d515b093b">num_fields</a>;
<a name="l00470"></a>00470 }
<a name="l00471"></a>00471 
<a name="l00472"></a><a class="code" href="schema_8h.html#a88f90cc6608be6564da34d8d95c8fb1f">00472</a> <a class="code" href="schema_8h.html#a5f79330712bfa8c414c6fe5192063108" title="Data record.">record</a> <a class="code" href="schema_8c.html#a88f90cc6608be6564da34d8d95c8fb1f">new_record</a> ( <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s )
<a name="l00473"></a>00473 {
<a name="l00474"></a>00474   <span class="keywordflow">if</span> ( s == NULL )
<a name="l00475"></a>00475     {
<a name="l00476"></a>00476       <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2fd6f336d08340583bd620a7f5694c90">ERROR</a>,  <span class="stringliteral">&quot;new_record: NULL schema!\n&quot;</span>);
<a name="l00477"></a>00477       exit (EXIT_FAILURE);
<a name="l00478"></a>00478     }
<a name="l00479"></a>00479   <a class="code" href="schema_8h.html#a5f79330712bfa8c414c6fe5192063108" title="Data record.">record</a> res = malloc (<span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *) * s-&gt;<a class="code" href="structschema__struct.html#ab666a6bb7024988fab74187d515b093b">num_fields</a>);
<a name="l00480"></a>00480         
<a name="l00481"></a>00481   <span class="comment">/* allocate memory for the fields */</span>
<a name="l00482"></a>00482   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> f;
<a name="l00483"></a>00483   <span class="keywordtype">int</span> i = 0;
<a name="l00484"></a>00484   <span class="keywordflow">for</span> ( f = s-&gt;<a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a>; f != NULL; f = f-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>, i++)
<a name="l00485"></a>00485     {
<a name="l00486"></a>00486         res[i] =  malloc (f-&gt;<a class="code" href="structfield__desc__struct.html#aa39caeaf90adb277f79f0f3aba000359">len</a>);
<a name="l00487"></a>00487     }
<a name="l00488"></a>00488   <span class="keywordflow">return</span> res;
<a name="l00489"></a>00489 }
<a name="l00490"></a>00490 
<a name="l00491"></a><a class="code" href="schema_8h.html#a1933612db3e4a006afe19cad5ccbcd08">00491</a> <span class="keywordtype">void</span> <a class="code" href="schema_8c.html#a1933612db3e4a006afe19cad5ccbcd08">release_record</a> ( <a class="code" href="schema_8h.html#a5f79330712bfa8c414c6fe5192063108" title="Data record.">record</a> r, <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s )
<a name="l00492"></a>00492 {
<a name="l00493"></a>00493   <span class="keywordflow">if</span> ( r == NULL || s == NULL )
<a name="l00494"></a>00494     {
<a name="l00495"></a>00495       <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2fd6f336d08340583bd620a7f5694c90">ERROR</a>,  <span class="stringliteral">&quot;release_record: NULL record or schema!\n&quot;</span> );
<a name="l00496"></a>00496       <span class="keywordflow">return</span>;
<a name="l00497"></a>00497     }
<a name="l00498"></a>00498   <span class="keywordtype">int</span> i;
<a name="l00499"></a>00499   <span class="keywordflow">for</span> ( i = 0; i &lt; s-&gt;<a class="code" href="structschema__struct.html#ab666a6bb7024988fab74187d515b093b">num_fields</a>; i++ )
<a name="l00500"></a>00500     {
<a name="l00501"></a>00501       free ( r[i] );
<a name="l00502"></a>00502     }
<a name="l00503"></a>00503   free (r);
<a name="l00504"></a>00504 }
<a name="l00505"></a>00505 
<a name="l00506"></a><a class="code" href="schema_8h.html#a124a8efaaf4dd5f326e9a80e20401464">00506</a> <span class="keywordtype">void</span> <a class="code" href="schema_8c.html#a124a8efaaf4dd5f326e9a80e20401464">assign_int_field</a> ( <span class="keywordtype">void</span> *field_p, <span class="keywordtype">int</span> int_val )
<a name="l00507"></a>00507 {
<a name="l00508"></a>00508   *(<span class="keywordtype">int</span> *)field_p = int_val;
<a name="l00509"></a>00509 }
<a name="l00510"></a>00510         
<a name="l00511"></a><a class="code" href="schema_8h.html#a9981be62382b8bda13997fd8adebf6dd">00511</a> <span class="keywordtype">void</span> <a class="code" href="schema_8c.html#a9981be62382b8bda13997fd8adebf6dd">assign_str_field</a> ( <span class="keywordtype">void</span> *field_p, <span class="keywordtype">char</span> *str_val )
<a name="l00512"></a>00512 {
<a name="l00513"></a>00513   strcpy (field_p, str_val);
<a name="l00514"></a>00514 }
<a name="l00515"></a>00515 
<a name="l00516"></a><a class="code" href="schema_8h.html#aea684fef15aedeca85e6132da5ff3969">00516</a> <span class="keywordtype">int</span> <a class="code" href="schema_8c.html#aea684fef15aedeca85e6132da5ff3969">fill_record</a> ( <a class="code" href="schema_8h.html#a5f79330712bfa8c414c6fe5192063108" title="Data record.">record</a> r, <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s, ...)
<a name="l00517"></a>00517 {
<a name="l00518"></a>00518   <span class="keywordflow">if</span> ( r == NULL || s == NULL )
<a name="l00519"></a>00519     {
<a name="l00520"></a>00520       <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2fd6f336d08340583bd620a7f5694c90">ERROR</a>,  <span class="stringliteral">&quot;fill_record: NULL record or schema!\n&quot;</span> );
<a name="l00521"></a>00521       <span class="keywordflow">return</span> -1;
<a name="l00522"></a>00522     }
<a name="l00523"></a>00523   va_list vals;
<a name="l00524"></a>00524   va_start (vals, s);
<a name="l00525"></a>00525   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> f;
<a name="l00526"></a>00526   <span class="keywordtype">int</span> i = 0;
<a name="l00527"></a>00527   <span class="keywordflow">for</span> ( f = s-&gt;<a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a>; f != NULL; f = f-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>, i++)
<a name="l00528"></a>00528     {
<a name="l00529"></a>00529       <span class="keywordflow">if</span> ( <a class="code" href="schema_8c.html#a8a501fb0eaf78f73ac37489694b95e0f">is_int_field</a> (f) )
<a name="l00530"></a>00530         <a class="code" href="schema_8c.html#a124a8efaaf4dd5f326e9a80e20401464">assign_int_field</a> (r[i], va_arg (vals, <span class="keywordtype">int</span>));
<a name="l00531"></a>00531       <span class="keywordflow">else</span>
<a name="l00532"></a>00532         <a class="code" href="schema_8c.html#a9981be62382b8bda13997fd8adebf6dd">assign_str_field</a> (r[i], va_arg (vals, <span class="keywordtype">char</span>*));
<a name="l00533"></a>00533     }
<a name="l00534"></a>00534   <span class="keywordflow">return</span> 0;
<a name="l00535"></a>00535 }
<a name="l00536"></a>00536 
<a name="l00537"></a>00537 <span class="keyword">static</span> <span class="keywordtype">void</span> fill_sub_record ( <a class="code" href="schema_8h.html#a5f79330712bfa8c414c6fe5192063108" title="Data record.">record</a> dest_r, <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> dest_s,
<a name="l00538"></a>00538                              <a class="code" href="schema_8h.html#a5f79330712bfa8c414c6fe5192063108" title="Data record.">record</a> src_r, <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> src_s)
<a name="l00539"></a>00539 {
<a name="l00540"></a>00540   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> src_f, dest_f;
<a name="l00541"></a>00541   <span class="keywordtype">int</span> i = 0, j = 0;
<a name="l00542"></a>00542   <span class="keywordflow">for</span> ( dest_f = dest_s-&gt;<a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a>; dest_f != NULL; dest_f = dest_f-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>, i++ )
<a name="l00543"></a>00543     {
<a name="l00544"></a>00544       <span class="keywordflow">for</span> (j = 0, src_f = src_s-&gt;<a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a>;
<a name="l00545"></a>00545            strcmp ( src_f-&gt;<a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">name</a>, dest_f-&gt;<a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">name</a> ) != 0;
<a name="l00546"></a>00546            j++, src_f = src_f-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>)
<a name="l00547"></a>00547         ;
<a name="l00548"></a>00548       <span class="keywordflow">if</span> ( <a class="code" href="schema_8c.html#a8a501fb0eaf78f73ac37489694b95e0f">is_int_field</a> (dest_f) )
<a name="l00549"></a>00549         <a class="code" href="schema_8c.html#a124a8efaaf4dd5f326e9a80e20401464">assign_int_field</a> (dest_r[i], *(<span class="keywordtype">int</span> *)src_r[j]);
<a name="l00550"></a>00550       <span class="keywordflow">else</span>
<a name="l00551"></a>00551         <a class="code" href="schema_8c.html#a9981be62382b8bda13997fd8adebf6dd">assign_str_field</a> (dest_r[i], (<span class="keywordtype">char</span> *)src_r[j]);
<a name="l00552"></a>00552     }
<a name="l00553"></a>00553 }
<a name="l00554"></a>00554 
<a name="l00555"></a><a class="code" href="schema_8h.html#abc5d4892c7a7e264602fc495eeb6e09d">00555</a> <span class="keywordtype">int</span> <a class="code" href="schema_8c.html#abc5d4892c7a7e264602fc495eeb6e09d">equal_record</a> ( <a class="code" href="schema_8h.html#a5f79330712bfa8c414c6fe5192063108" title="Data record.">record</a> r1, <a class="code" href="schema_8h.html#a5f79330712bfa8c414c6fe5192063108" title="Data record.">record</a> r2, <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s )
<a name="l00556"></a>00556 {
<a name="l00557"></a>00557   <span class="keywordflow">if</span> ( r1 == NULL || r2 == NULL || s == NULL )
<a name="l00558"></a>00558     {
<a name="l00559"></a>00559       <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2fd6f336d08340583bd620a7f5694c90">ERROR</a>,  <span class="stringliteral">&quot;equal_record: NULL record or schema!\n&quot;</span> );
<a name="l00560"></a>00560       <span class="keywordflow">return</span> 0;
<a name="l00561"></a>00561     }
<a name="l00562"></a>00562 
<a name="l00563"></a>00563   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> fd;
<a name="l00564"></a>00564   <span class="keywordtype">int</span> i = 0;;
<a name="l00565"></a>00565   <span class="keywordflow">for</span> ( fd = s-&gt;<a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a>; fd != NULL; fd = fd-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>, i++)
<a name="l00566"></a>00566     {
<a name="l00567"></a>00567       <span class="keywordflow">if</span> ( <a class="code" href="schema_8c.html#a8a501fb0eaf78f73ac37489694b95e0f">is_int_field</a> (fd) )
<a name="l00568"></a>00568         {
<a name="l00569"></a>00569           <span class="keywordflow">if</span> (*(<span class="keywordtype">int</span> *)r1[i] != *(<span class="keywordtype">int</span> *)r2[i])
<a name="l00570"></a>00570             <span class="keywordflow">return</span> 0;
<a name="l00571"></a>00571         }
<a name="l00572"></a>00572       <span class="keywordflow">else</span>
<a name="l00573"></a>00573         {
<a name="l00574"></a>00574           <span class="keywordflow">if</span> ( strcmp ((<span class="keywordtype">char</span> *)r1[i], (<span class="keywordtype">char</span> *)r2[i]) != 0 )
<a name="l00575"></a>00575             <span class="keywordflow">return</span> 0;
<a name="l00576"></a>00576         }
<a name="l00577"></a>00577     }
<a name="l00578"></a>00578   <span class="keywordflow">return</span> 1;
<a name="l00579"></a>00579 }
<a name="l00580"></a>00580 
<a name="l00581"></a><a class="code" href="schema_8h.html#a0e4e9fed419a0c94894a18aee62ab135">00581</a> <span class="keywordtype">void</span> <a class="code" href="schema_8c.html#a0e4e9fed419a0c94894a18aee62ab135">set_tbl_position</a> ( <a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a> t, <a class="code" href="schema_8h.html#a03850a83574de4bb3d8832fcd3faff43">tbl_position</a> pos )
<a name="l00582"></a>00582 {
<a name="l00583"></a>00583   <span class="keywordflow">switch</span> (pos) {
<a name="l00584"></a>00584   <span class="keywordflow">case</span> <a class="code" href="schema_8h.html#a03850a83574de4bb3d8832fcd3faff43aa489a4bfea60d57e13b49ec708d128ef">TBL_BEG</a>:
<a name="l00585"></a>00585     {
<a name="l00586"></a>00586       t-&gt;<a class="code" href="structtbl__desc__struct.html#ab921d6fac328972ca0d1ff9289ec616c">current_pg</a> = <a class="code" href="pager_8c.html#ac6d302e61f9ef0658896f6f269372f29">get_page</a> (t-&gt;<a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">sch</a>-&gt;<a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">name</a>, 0);
<a name="l00587"></a>00587       <a class="code" href="pager_8c.html#a6b823fe5794c31c0a5d987f60568c556">page_set_pos_begin</a> ( t-&gt; current_pg );
<a name="l00588"></a>00588     }
<a name="l00589"></a>00589     <span class="keywordflow">break</span>;
<a name="l00590"></a>00590   <span class="keywordflow">case</span> <a class="code" href="schema_8h.html#a03850a83574de4bb3d8832fcd3faff43aa32756fd30dfa60bb104fc1767d0fc2e">TBL_END</a>:
<a name="l00591"></a>00591     t-&gt;<a class="code" href="structtbl__desc__struct.html#ab921d6fac328972ca0d1ff9289ec616c">current_pg</a> = <a class="code" href="pager_8c.html#ad663e3f2e8c5daaae8f5002e56689dc4">get_page_for_append</a> ( t-&gt;<a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">sch</a>-&gt;<a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">name</a> );
<a name="l00592"></a>00592   }
<a name="l00593"></a>00593 }
<a name="l00594"></a>00594 
<a name="l00596"></a>00596 <span class="keyword">static</span> <span class="keywordtype">int</span> page_valid_pos_for_get_with_schema ( <a class="code" href="structpage__struct.html" title="Database buffer page.">page_p</a> p, <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s )
<a name="l00597"></a>00597 {
<a name="l00598"></a>00598   <span class="keywordflow">return</span> (<a class="code" href="pager_8c.html#ab2ec49e0fd3c00804c5cf019ffd939f0">page_valid_pos_for_get</a> (p, <a class="code" href="pager_8c.html#a22cd5cbd3395cfcf1683e5d26d368a87">page_current_pos</a>(p))
<a name="l00599"></a>00599           &amp;&amp; (<a class="code" href="pager_8c.html#a22cd5cbd3395cfcf1683e5d26d368a87">page_current_pos</a>(p) - <a class="code" href="pager_8h.html#af11125b8a270a84314fdb616e19b11ec">PAGE_HEADER_SIZE</a>) % s-&gt;<a class="code" href="structschema__struct.html#a5aadf53e04e8e3231b15ac2465057ab4">len</a> == 0);
<a name="l00600"></a>00600 }
<a name="l00601"></a>00601 
<a name="l00603"></a>00603 <span class="keyword">static</span> <span class="keywordtype">int</span> page_valid_pos_for_put_with_schema ( <a class="code" href="structpage__struct.html" title="Database buffer page.">page_p</a> p, <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s )
<a name="l00604"></a>00604 {
<a name="l00605"></a>00605   <span class="keywordflow">return</span> (<a class="code" href="pager_8c.html#a4017443dc8ef65a01c4036cb34309c35">page_valid_pos_for_put</a> (p, <a class="code" href="pager_8c.html#a22cd5cbd3395cfcf1683e5d26d368a87">page_current_pos</a>(p), s-&gt;<a class="code" href="structschema__struct.html#a5aadf53e04e8e3231b15ac2465057ab4">len</a>)
<a name="l00606"></a>00606           &amp;&amp; (<a class="code" href="pager_8c.html#a22cd5cbd3395cfcf1683e5d26d368a87">page_current_pos</a>(p) - <a class="code" href="pager_8h.html#af11125b8a270a84314fdb616e19b11ec">PAGE_HEADER_SIZE</a>) % s-&gt;<a class="code" href="structschema__struct.html#a5aadf53e04e8e3231b15ac2465057ab4">len</a> == 0);
<a name="l00607"></a>00607 }
<a name="l00608"></a>00608 
<a name="l00609"></a>00609 <span class="keyword">static</span> <a class="code" href="structpage__struct.html" title="Database buffer page.">page_p</a> get_page_for_next_record ( <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s )
<a name="l00610"></a>00610 {
<a name="l00611"></a>00611   <a class="code" href="structpage__struct.html" title="Database buffer page.">page_p</a> pg = s-&gt;<a class="code" href="structschema__struct.html#abaea04252495760a93d8d4a3386d0681">tbl</a>-&gt;<a class="code" href="structtbl__desc__struct.html#ab921d6fac328972ca0d1ff9289ec616c">current_pg</a>;
<a name="l00612"></a>00612   <span class="keywordflow">if</span> (<a class="code" href="pager_8c.html#a579742e19ba1c0fd2ecf4d72f63ecfa4">eof</a>(pg)) <span class="keywordflow">return</span> NULL;
<a name="l00613"></a>00613   <span class="keywordflow">if</span> (<a class="code" href="pager_8c.html#a3a7e91c1ecf48d397e533ca229649754">eob</a>(pg))
<a name="l00614"></a>00614     {
<a name="l00615"></a>00615       <a class="code" href="pager_8c.html#a1cbbae211b6411ea79d80d45f9831c62">unpin</a> (pg);
<a name="l00616"></a>00616       pg = <a class="code" href="pager_8c.html#ab05479ee43554db35ff2a157d9c39592">get_next_page</a> (pg);
<a name="l00617"></a>00617       <span class="keywordflow">if</span> ( pg == NULL)
<a name="l00618"></a>00618         {
<a name="l00619"></a>00619           <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada651d8a47a6976d6fe05c0e03fb4cd2d0">FATAL</a>, <span class="stringliteral">&quot;get_page_for_next_record failed at block %d\n&quot;</span>,
<a name="l00620"></a>00620                    <a class="code" href="pager_8c.html#a4edda2c8b563580051237b2071b61f57">page_block_nr</a>(pg) + 1);
<a name="l00621"></a>00621           exit (EXIT_FAILURE);
<a name="l00622"></a>00622         }
<a name="l00623"></a>00623       <a class="code" href="pager_8c.html#a6b823fe5794c31c0a5d987f60568c556">page_set_pos_begin</a> (pg);
<a name="l00624"></a>00624       s-&gt;<a class="code" href="structschema__struct.html#abaea04252495760a93d8d4a3386d0681">tbl</a>-&gt;<a class="code" href="structtbl__desc__struct.html#ab921d6fac328972ca0d1ff9289ec616c">current_pg</a> = pg;
<a name="l00625"></a>00625     }
<a name="l00626"></a>00626   <span class="keywordflow">return</span> pg;
<a name="l00627"></a>00627 }
<a name="l00628"></a>00628 
<a name="l00629"></a>00629 <span class="keyword">static</span> <span class="keywordtype">int</span> get_page_record ( <a class="code" href="structpage__struct.html" title="Database buffer page.">page_p</a> p, <a class="code" href="schema_8h.html#a5f79330712bfa8c414c6fe5192063108" title="Data record.">record</a> r, <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s )
<a name="l00630"></a>00630 {
<a name="l00631"></a>00631   <span class="keywordflow">if</span> ( p == NULL ) <span class="keywordflow">return</span> 0;
<a name="l00632"></a>00632   <span class="keywordflow">if</span> (!page_valid_pos_for_get_with_schema (p, s))
<a name="l00633"></a>00633     {
<a name="l00634"></a>00634       <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada651d8a47a6976d6fe05c0e03fb4cd2d0">FATAL</a>, <span class="stringliteral">&quot;try to get record at invalid position.\n&quot;</span>);
<a name="l00635"></a>00635       exit (EXIT_FAILURE);
<a name="l00636"></a>00636     }
<a name="l00637"></a>00637   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> fld_desc;
<a name="l00638"></a>00638   <span class="keywordtype">int</span> i = 0;
<a name="l00639"></a>00639   <span class="keywordflow">for</span> ( fld_desc = s-&gt;<a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a>; fld_desc != NULL;
<a name="l00640"></a>00640         fld_desc = fld_desc-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>, i++)
<a name="l00641"></a>00641     <span class="keywordflow">if</span> ( <a class="code" href="schema_8c.html#a8a501fb0eaf78f73ac37489694b95e0f">is_int_field</a> (fld_desc) )
<a name="l00642"></a>00642       <a class="code" href="schema_8c.html#a124a8efaaf4dd5f326e9a80e20401464">assign_int_field</a> (r[i], <a class="code" href="pager_8c.html#adceb30d34ca97faf083e03c2d2599d47">page_get_int</a>(p));
<a name="l00643"></a>00643     <span class="keywordflow">else</span>
<a name="l00644"></a>00644       <a class="code" href="pager_8c.html#a5f00bd55b790f59837b93fe81f178a62">page_get_str</a>(p, r[i], fld_desc-&gt;<a class="code" href="structfield__desc__struct.html#aa39caeaf90adb277f79f0f3aba000359">len</a>);
<a name="l00645"></a>00645   <span class="keywordflow">return</span> 1;
<a name="l00646"></a>00646 }
<a name="l00647"></a>00647 
<a name="l00648"></a><a class="code" href="schema_8h.html#a80f6551dc784704bc93443d7981052fc">00648</a> <span class="keywordtype">int</span> <a class="code" href="schema_8c.html#a80f6551dc784704bc93443d7981052fc">get_record</a> ( <a class="code" href="schema_8h.html#a5f79330712bfa8c414c6fe5192063108" title="Data record.">record</a> r, <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s )
<a name="l00649"></a>00649 {
<a name="l00650"></a>00650   <a class="code" href="structpage__struct.html" title="Database buffer page.">page_p</a> pg = get_page_for_next_record (s);
<a name="l00651"></a>00651   <span class="keywordflow">if</span> ( pg == NULL ) <span class="keywordflow">return</span> 0;
<a name="l00652"></a>00652   <span class="keywordflow">return</span> get_page_record ( pg, r, s );
<a name="l00653"></a>00653 }
<a name="l00654"></a>00654 
<a name="l00655"></a>00655 <span class="keyword">static</span> <span class="keywordtype">int</span> int_equal ( <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y )
<a name="l00656"></a>00656 {
<a name="l00657"></a>00657   <span class="keywordflow">return</span> x == y;
<a name="l00658"></a>00658 }
<a name="l00659"></a>00659 
<a name="l00660"></a><a class="code" href="schema_8c.html#aab130fe92bf76445a675ef3f7482e45a">00660</a> <span class="keywordtype">int</span> <a class="code" href="schema_8c.html#aab130fe92bf76445a675ef3f7482e45a">find_record_int_val</a> ( <a class="code" href="schema_8h.html#a5f79330712bfa8c414c6fe5192063108" title="Data record.">record</a> r, <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s, <span class="keywordtype">int</span> offset,
<a name="l00661"></a>00661                           <span class="keywordtype">int</span> (*op) (<span class="keywordtype">int</span>, <span class="keywordtype">int</span>), <span class="keywordtype">int</span> val)
<a name="l00662"></a>00662 {
<a name="l00663"></a>00663   <a class="code" href="structpage__struct.html" title="Database buffer page.">page_p</a> pg = get_page_for_next_record (s);
<a name="l00664"></a>00664   <span class="keywordflow">if</span> ( pg == NULL ) <span class="keywordflow">return</span> 0;
<a name="l00665"></a>00665   <span class="keywordtype">int</span> pos, rec_val;
<a name="l00666"></a>00666   <span class="keywordflow">for</span> ( ; pg != NULL; pg = get_page_for_next_record (s) )
<a name="l00667"></a>00667     {
<a name="l00668"></a>00668       pos = <a class="code" href="pager_8c.html#a22cd5cbd3395cfcf1683e5d26d368a87">page_current_pos</a> (pg);
<a name="l00669"></a>00669       rec_val = <a class="code" href="pager_8c.html#a139b8f8707d0a1d86dd103f912876abb">page_get_int_at</a> (pg, pos + offset);
<a name="l00670"></a>00670       <span class="keywordflow">if</span> ( (*op) (val, rec_val) )
<a name="l00671"></a>00671         {
<a name="l00672"></a>00672           <a class="code" href="pager_8c.html#a56a50369677f6867f99c527b240af50e">page_set_current_pos</a> (pg, pos);
<a name="l00673"></a>00673           get_page_record ( pg, r, s );
<a name="l00674"></a>00674           <span class="keywordflow">return</span> 1;
<a name="l00675"></a>00675         }
<a name="l00676"></a>00676       <span class="keywordflow">else</span>
<a name="l00677"></a>00677         <a class="code" href="pager_8c.html#a56a50369677f6867f99c527b240af50e">page_set_current_pos</a> (pg, pos + s-&gt;<a class="code" href="structschema__struct.html#a5aadf53e04e8e3231b15ac2465057ab4">len</a>);
<a name="l00678"></a>00678     }
<a name="l00679"></a>00679   <span class="keywordflow">return</span> 0;
<a name="l00680"></a>00680 }
<a name="l00681"></a>00681 
<a name="l00682"></a>00682 <span class="keyword">static</span> <span class="keywordtype">int</span> put_page_record ( <a class="code" href="structpage__struct.html" title="Database buffer page.">page_p</a> p, <a class="code" href="schema_8h.html#a5f79330712bfa8c414c6fe5192063108" title="Data record.">record</a> r, <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s )
<a name="l00683"></a>00683 {
<a name="l00684"></a>00684   <span class="keywordflow">if</span> (!page_valid_pos_for_put_with_schema (p, s))
<a name="l00685"></a>00685     <span class="keywordflow">return</span> -1;
<a name="l00686"></a>00686 
<a name="l00687"></a>00687   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> fld_desc;
<a name="l00688"></a>00688   <span class="keywordtype">int</span> i = 0;
<a name="l00689"></a>00689   <span class="keywordflow">for</span> ( fld_desc = s-&gt;<a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a>; fld_desc != NULL;
<a name="l00690"></a>00690         fld_desc = fld_desc-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>, i++)
<a name="l00691"></a>00691     <span class="keywordflow">if</span> ( <a class="code" href="schema_8c.html#a8a501fb0eaf78f73ac37489694b95e0f">is_int_field</a> (fld_desc) )
<a name="l00692"></a>00692       <a class="code" href="pager_8c.html#ab3ad5188ed0e9194283c6fb120b1c805">page_put_int</a>(p, *(<span class="keywordtype">int</span> *)r[i]);
<a name="l00693"></a>00693     <span class="keywordflow">else</span>
<a name="l00694"></a>00694       <a class="code" href="pager_8c.html#a36162a65146dbae9c6c2cecad2596350">page_put_str</a>(p, (<span class="keywordtype">char</span> *)r[i], fld_desc-&gt;<a class="code" href="structfield__desc__struct.html#aa39caeaf90adb277f79f0f3aba000359">len</a>);
<a name="l00695"></a>00695   <span class="keywordflow">return</span> 0;
<a name="l00696"></a>00696 }
<a name="l00697"></a>00697 
<a name="l00698"></a><a class="code" href="schema_8h.html#a4c29afdbb018988c2e25973b0d2ccafc">00698</a> <span class="keywordtype">int</span> <a class="code" href="schema_8c.html#a4c29afdbb018988c2e25973b0d2ccafc">put_record</a> ( <a class="code" href="schema_8h.html#a5f79330712bfa8c414c6fe5192063108" title="Data record.">record</a> r, <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s )
<a name="l00699"></a>00699 {
<a name="l00700"></a>00700   <a class="code" href="structpage__struct.html" title="Database buffer page.">page_p</a> p = s-&gt;<a class="code" href="structschema__struct.html#abaea04252495760a93d8d4a3386d0681">tbl</a>-&gt;<a class="code" href="structtbl__desc__struct.html#ab921d6fac328972ca0d1ff9289ec616c">current_pg</a>;
<a name="l00701"></a>00701 
<a name="l00702"></a>00702   <span class="keywordflow">if</span> (!page_valid_pos_for_put_with_schema (p, s))
<a name="l00703"></a>00703     <span class="keywordflow">return</span> -1;
<a name="l00704"></a>00704 
<a name="l00705"></a>00705   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> fld_desc;
<a name="l00706"></a>00706   <span class="keywordtype">int</span> i = 0;
<a name="l00707"></a>00707   <span class="keywordflow">for</span> ( fld_desc = s-&gt;<a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a>; fld_desc != NULL;
<a name="l00708"></a>00708         fld_desc = fld_desc-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>, i++)
<a name="l00709"></a>00709     <span class="keywordflow">if</span> ( <a class="code" href="schema_8c.html#a8a501fb0eaf78f73ac37489694b95e0f">is_int_field</a> (fld_desc) )
<a name="l00710"></a>00710       <a class="code" href="pager_8c.html#ab3ad5188ed0e9194283c6fb120b1c805">page_put_int</a>(p, *(<span class="keywordtype">int</span> *)r[i]);
<a name="l00711"></a>00711     <span class="keywordflow">else</span>
<a name="l00712"></a>00712       <a class="code" href="pager_8c.html#a36162a65146dbae9c6c2cecad2596350">page_put_str</a>(p, (<span class="keywordtype">char</span> *)r[i], fld_desc-&gt;<a class="code" href="structfield__desc__struct.html#aa39caeaf90adb277f79f0f3aba000359">len</a>);
<a name="l00713"></a>00713   <span class="keywordflow">return</span> 0;
<a name="l00714"></a>00714 }
<a name="l00715"></a>00715 
<a name="l00716"></a><a class="code" href="schema_8h.html#a90961f0e8dbd1176d7b0766c8ef23a88">00716</a> <span class="keywordtype">int</span> <a class="code" href="schema_8c.html#a90961f0e8dbd1176d7b0766c8ef23a88">append_record</a> ( <a class="code" href="schema_8h.html#a5f79330712bfa8c414c6fe5192063108" title="Data record.">record</a> r, <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s )
<a name="l00717"></a>00717 {
<a name="l00718"></a>00718   <a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a> tbl = s-&gt;<a class="code" href="structschema__struct.html#abaea04252495760a93d8d4a3386d0681">tbl</a>;
<a name="l00719"></a>00719   <a class="code" href="structpage__struct.html" title="Database buffer page.">page_p</a> pg = <a class="code" href="pager_8c.html#ad663e3f2e8c5daaae8f5002e56689dc4">get_page_for_append</a> ( s-&gt;<a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">name</a> );
<a name="l00720"></a>00720   <span class="keywordflow">if</span> (pg == NULL)
<a name="l00721"></a>00721     {
<a name="l00722"></a>00722       <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada651d8a47a6976d6fe05c0e03fb4cd2d0">FATAL</a>, <span class="stringliteral">&quot;Failed to get page for appending to \&quot;%s\&quot;.\n&quot;</span>,
<a name="l00723"></a>00723                s-&gt;<a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">name</a>);
<a name="l00724"></a>00724       exit (EXIT_FAILURE);
<a name="l00725"></a>00725     }
<a name="l00726"></a>00726   <span class="keywordflow">if</span> ( put_page_record (pg, r, s) == -1 )
<a name="l00727"></a>00727     {
<a name="l00728"></a>00728       <span class="comment">/* not enough space in the current page */</span>
<a name="l00729"></a>00729       <a class="code" href="pager_8c.html#a1cbbae211b6411ea79d80d45f9831c62">unpin</a> (pg);
<a name="l00730"></a>00730       pg = <a class="code" href="pager_8c.html#ab05479ee43554db35ff2a157d9c39592">get_next_page</a> ( pg );
<a name="l00731"></a>00731       <span class="keywordflow">if</span> (pg == NULL)
<a name="l00732"></a>00732         {
<a name="l00733"></a>00733           <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada651d8a47a6976d6fe05c0e03fb4cd2d0">FATAL</a>, <span class="stringliteral">&quot;Failed to get page for \&quot;%s\&quot; block %d.\n&quot;</span>,
<a name="l00734"></a>00734                    s-&gt;<a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">name</a>, <a class="code" href="pager_8c.html#a4edda2c8b563580051237b2071b61f57">page_block_nr</a>(pg) + 1);
<a name="l00735"></a>00735           exit (EXIT_FAILURE);
<a name="l00736"></a>00736         }
<a name="l00737"></a>00737       <span class="keywordflow">if</span> ( put_page_record (pg, r, s) == -1 )
<a name="l00738"></a>00738         {
<a name="l00739"></a>00739           <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada651d8a47a6976d6fe05c0e03fb4cd2d0">FATAL</a>, <span class="stringliteral">&quot;Failed to put record to page for \&quot;%s\&quot; block %d.\n&quot;</span>,
<a name="l00740"></a>00740                    s-&gt;<a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">name</a>, <a class="code" href="pager_8c.html#a4edda2c8b563580051237b2071b61f57">page_block_nr</a>(pg) + 1);
<a name="l00741"></a>00741           exit (EXIT_FAILURE);
<a name="l00742"></a>00742         }
<a name="l00743"></a>00743     }
<a name="l00744"></a>00744   tbl-&gt;<a class="code" href="structtbl__desc__struct.html#ab921d6fac328972ca0d1ff9289ec616c">current_pg</a> = pg;
<a name="l00745"></a>00745   tbl-&gt;<a class="code" href="structtbl__desc__struct.html#a94e4b2edc45fb1c37e41de24fe494a4d">num_records</a>++;
<a name="l00746"></a>00746   <span class="keywordflow">return</span> 0;
<a name="l00747"></a>00747 }
<a name="l00748"></a>00748 
<a name="l00749"></a>00749 <span class="keyword">static</span> <span class="keywordtype">void</span> display_tbl_header ( <a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a> t )
<a name="l00750"></a>00750 {
<a name="l00751"></a>00751   <span class="keywordflow">if</span> ( t == NULL )
<a name="l00752"></a>00752     {
<a name="l00753"></a>00753       <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada748005382152808a72b1a9177d9dc806">INFO</a>,  <span class="stringliteral">&quot;Trying to display non-existant table.\n&quot;</span>);
<a name="l00754"></a>00754       <span class="keywordflow">return</span>;
<a name="l00755"></a>00755     }
<a name="l00756"></a>00756   <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s = t-&gt;<a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">sch</a>;
<a name="l00757"></a>00757   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> f;
<a name="l00758"></a>00758   <span class="keywordflow">for</span> ( f = s-&gt;<a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a>; f != NULL; f = f-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>)
<a name="l00759"></a>00759     <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2a4d3752e9aa5f28fc2dacb0f948de06">FORCE</a>, <span class="stringliteral">&quot;%20s&quot;</span>, f-&gt;<a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">name</a>);
<a name="l00760"></a>00760   <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2a4d3752e9aa5f28fc2dacb0f948de06">FORCE</a>, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00761"></a>00761   <span class="keywordtype">int</span> i;
<a name="l00762"></a>00762   <span class="keywordflow">for</span> ( f = s-&gt;<a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a>; f != NULL; f = f-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>)
<a name="l00763"></a>00763     {
<a name="l00764"></a>00764       <span class="keywordflow">for</span> ( i = 0; i &lt; 20 - strlen(f-&gt;<a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">name</a>); i++)
<a name="l00765"></a>00765         <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2a4d3752e9aa5f28fc2dacb0f948de06">FORCE</a>, <span class="stringliteral">&quot; &quot;</span>);
<a name="l00766"></a>00766       <span class="keywordflow">for</span> ( i = 0; i &lt; strlen(f-&gt;<a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">name</a>); i++)
<a name="l00767"></a>00767         <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2a4d3752e9aa5f28fc2dacb0f948de06">FORCE</a>, <span class="stringliteral">&quot;-&quot;</span>);
<a name="l00768"></a>00768     }
<a name="l00769"></a>00769   <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2a4d3752e9aa5f28fc2dacb0f948de06">FORCE</a>, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00770"></a>00770 }
<a name="l00771"></a>00771 
<a name="l00772"></a>00772 <span class="keyword">static</span> <span class="keywordtype">void</span> display_record ( <a class="code" href="schema_8h.html#a5f79330712bfa8c414c6fe5192063108" title="Data record.">record</a> r, <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s )
<a name="l00773"></a>00773 {
<a name="l00774"></a>00774   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> f = s-&gt;<a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a>;
<a name="l00775"></a>00775   <span class="keywordtype">int</span> i = 0;
<a name="l00776"></a>00776   <span class="keywordflow">for</span> ( ; f != NULL; f = f-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>, i++ )
<a name="l00777"></a>00777     {
<a name="l00778"></a>00778       <span class="keywordflow">if</span> ( <a class="code" href="schema_8c.html#a8a501fb0eaf78f73ac37489694b95e0f">is_int_field</a> (f) )
<a name="l00779"></a>00779         <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2a4d3752e9aa5f28fc2dacb0f948de06">FORCE</a>, <span class="stringliteral">&quot;%20d&quot;</span>, *(<span class="keywordtype">int</span> *)r[i] );
<a name="l00780"></a>00780       <span class="keywordflow">else</span>
<a name="l00781"></a>00781         <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2a4d3752e9aa5f28fc2dacb0f948de06">FORCE</a>, <span class="stringliteral">&quot;%20s&quot;</span>, (<span class="keywordtype">char</span> *)r[i] );
<a name="l00782"></a>00782     }
<a name="l00783"></a>00783   <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2a4d3752e9aa5f28fc2dacb0f948de06">FORCE</a>, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00784"></a>00784 }
<a name="l00785"></a>00785 
<a name="l00786"></a><a class="code" href="schema_8h.html#af39c79810af6f5478dead5f53b3439f4">00786</a> <span class="keywordtype">void</span> <a class="code" href="schema_8c.html#a8cbff5a15458a411c52068da40ef4d01">table_display</a> ( <a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a> t )
<a name="l00787"></a>00787 {
<a name="l00788"></a>00788   <span class="keywordflow">if</span> (t == NULL) <span class="keywordflow">return</span>;
<a name="l00789"></a>00789   display_tbl_header (t);
<a name="l00790"></a>00790   
<a name="l00791"></a>00791   <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s = t-&gt;<a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">sch</a>;
<a name="l00792"></a>00792   <a class="code" href="schema_8h.html#a5f79330712bfa8c414c6fe5192063108" title="Data record.">record</a> rec = <a class="code" href="schema_8c.html#a88f90cc6608be6564da34d8d95c8fb1f">new_record</a> ( s );
<a name="l00793"></a>00793   <a class="code" href="schema_8c.html#a0e4e9fed419a0c94894a18aee62ab135">set_tbl_position</a> ( t, <a class="code" href="schema_8h.html#a03850a83574de4bb3d8832fcd3faff43aa489a4bfea60d57e13b49ec708d128ef">TBL_BEG</a> );
<a name="l00794"></a>00794   <span class="keywordflow">while</span> ( <a class="code" href="schema_8c.html#a80f6551dc784704bc93443d7981052fc">get_record</a> (rec, s) )
<a name="l00795"></a>00795     {
<a name="l00796"></a>00796       display_record (rec, s);
<a name="l00797"></a>00797     }
<a name="l00798"></a>00798   <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2a4d3752e9aa5f28fc2dacb0f948de06">FORCE</a>, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00799"></a>00799 
<a name="l00800"></a>00800   <a class="code" href="schema_8c.html#a1933612db3e4a006afe19cad5ccbcd08">release_record</a> (rec, s);
<a name="l00801"></a>00801 }
<a name="l00802"></a>00802 
<a name="l00803"></a><a class="code" href="schema_8h.html#a7cb16036e70eadd9b39def21c6cd974a">00803</a> <a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a> <a class="code" href="schema_8c.html#a7cb16036e70eadd9b39def21c6cd974a">table_search</a> (<a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a> t, <span class="keywordtype">char</span> *attr, <span class="keywordtype">char</span> *op, <span class="keywordtype">int</span> val)
<a name="l00804"></a>00804 {
<a name="l00805"></a>00805   <span class="keywordflow">if</span> (t == NULL) <span class="keywordflow">return</span> NULL;
<a name="l00806"></a>00806 
<a name="l00807"></a>00807   <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s = t-&gt;<a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">sch</a>;
<a name="l00808"></a>00808   <a class="code" href="structfield__desc__struct.html" title="Field descriptor.">field_desc_p</a> f;
<a name="l00809"></a>00809   <span class="keywordtype">int</span> i = 0;
<a name="l00810"></a>00810   <span class="keywordflow">for</span> ( f = s-&gt;<a class="code" href="structschema__struct.html#ae4e8fee19f925bb92355cbe973b76344">first</a>; f != NULL; f = f-&gt;<a class="code" href="structfield__desc__struct.html#a49f5d997e5c9f5c37d4e987647160ab4">next</a>, i++)
<a name="l00811"></a>00811     <span class="keywordflow">if</span> ( strcmp (f-&gt;<a class="code" href="structfield__desc__struct.html#a89d98dbfad4e864aeccee71cbf00945d">name</a>, attr) == 0)
<a name="l00812"></a>00812       {
<a name="l00813"></a>00813         <span class="keywordflow">if</span> ( f-&gt;<a class="code" href="structfield__desc__struct.html#a762a02070ab6ef49c1f79ffda1574b9a">type</a> != <a class="code" href="schema_8h.html#af4e6ca114114786cc23f3d5a1f8d14bfa7fee88532b24b79bf2a88688a5d681d7">INT_TYPE</a> )
<a name="l00814"></a>00814           {
<a name="l00815"></a>00815             <a class="code" href="pmsg_8c.html#ae618535a5f034ee32c5305d8ed6b5446" title="Start a new message line.">put_msg</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada2fd6f336d08340583bd620a7f5694c90">ERROR</a>, <span class="stringliteral">&quot;\&quot;%s\&quot; is not an integer field.\n&quot;</span>, attr);
<a name="l00816"></a>00816             <span class="keywordflow">return</span> NULL;
<a name="l00817"></a>00817           }
<a name="l00818"></a>00818         <span class="keywordflow">break</span>;
<a name="l00819"></a>00819       }
<a name="l00820"></a>00820   <span class="keywordflow">if</span> ( f == NULL ) <span class="keywordflow">return</span> NULL;
<a name="l00821"></a>00821 
<a name="l00822"></a>00822   <span class="keywordtype">char</span> tmp_name[30] = <span class="stringliteral">&quot;tmp_tbl__&quot;</span>;
<a name="l00823"></a>00823   strcat (tmp_name, s-&gt;<a class="code" href="structschema__struct.html#abc365b0ba832b71b404ab857cec5ecbc">name</a>);
<a name="l00824"></a>00824   <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> res_sch = copy_schema ( s, tmp_name );
<a name="l00825"></a>00825   <a class="code" href="schema_8h.html#a5f79330712bfa8c414c6fe5192063108" title="Data record.">record</a> rec = <a class="code" href="schema_8c.html#a88f90cc6608be6564da34d8d95c8fb1f">new_record</a> ( s );
<a name="l00826"></a>00826 
<a name="l00827"></a>00827   <a class="code" href="schema_8c.html#a0e4e9fed419a0c94894a18aee62ab135">set_tbl_position</a> ( t, <a class="code" href="schema_8h.html#a03850a83574de4bb3d8832fcd3faff43aa489a4bfea60d57e13b49ec708d128ef">TBL_BEG</a> );
<a name="l00828"></a>00828   <span class="keywordflow">while</span> ( <a class="code" href="schema_8c.html#aab130fe92bf76445a675ef3f7482e45a">find_record_int_val</a> (rec, s, f-&gt;<a class="code" href="structfield__desc__struct.html#a496a2d85425c50e9f748a5cb974c68a6">offset</a>, int_equal, val) )
<a name="l00829"></a>00829     {
<a name="l00830"></a>00830       <a class="code" href="schema_8c.html#a444fc4fb5a7c13e99feb53df056c02ed">put_record_info</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada0593585da9181e972974c1274d8f2b4f">DEBUG</a>, rec, s);
<a name="l00831"></a>00831       <a class="code" href="schema_8c.html#a90961f0e8dbd1176d7b0766c8ef23a88">append_record</a> ( rec, res_sch );
<a name="l00832"></a>00832     }
<a name="l00833"></a>00833 
<a name="l00834"></a>00834   <a class="code" href="schema_8c.html#a1933612db3e4a006afe19cad5ccbcd08">release_record</a> (rec, s);
<a name="l00835"></a>00835 
<a name="l00836"></a>00836   <span class="keywordflow">return</span> res_sch-&gt;<a class="code" href="structschema__struct.html#abaea04252495760a93d8d4a3386d0681">tbl</a>;
<a name="l00837"></a>00837 }
<a name="l00838"></a>00838 
<a name="l00839"></a><a class="code" href="schema_8h.html#a8f3c94d2b0101d794119dc7601e867a8">00839</a> <a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a> <a class="code" href="schema_8c.html#a8f3c94d2b0101d794119dc7601e867a8">table_project</a> ( <a class="code" href="structtbl__desc__struct.html" title="Table descriptor.">tbl_p</a> t, <span class="keyword">const</span> <span class="keywordtype">char</span> *dest_name,
<a name="l00840"></a>00840                       <span class="keywordtype">int</span> num_fields, <span class="keywordtype">char</span> *fields[] )
<a name="l00841"></a>00841 {
<a name="l00842"></a>00842   <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> s = t-&gt;<a class="code" href="structtbl__desc__struct.html#a044bc349eb468b8e317199169423b6b9">sch</a>;
<a name="l00843"></a>00843   <a class="code" href="structschema__struct.html" title="Table/record schema.">schema_p</a> dest = make_sub_schema ( s, dest_name, num_fields, fields );
<a name="l00844"></a>00844   <span class="keywordflow">if</span> ( dest == NULL ) <span class="keywordflow">return</span> NULL;
<a name="l00845"></a>00845 
<a name="l00846"></a>00846   <a class="code" href="schema_8h.html#a5f79330712bfa8c414c6fe5192063108" title="Data record.">record</a> rec = <a class="code" href="schema_8c.html#a88f90cc6608be6564da34d8d95c8fb1f">new_record</a> ( s ), rec_dest = <a class="code" href="schema_8c.html#a88f90cc6608be6564da34d8d95c8fb1f">new_record</a> ( dest );
<a name="l00847"></a>00847 
<a name="l00848"></a>00848   <a class="code" href="schema_8c.html#a0e4e9fed419a0c94894a18aee62ab135">set_tbl_position</a> ( t, <a class="code" href="schema_8h.html#a03850a83574de4bb3d8832fcd3faff43aa489a4bfea60d57e13b49ec708d128ef">TBL_BEG</a> );
<a name="l00849"></a>00849   <span class="keywordflow">while</span> ( <a class="code" href="schema_8c.html#a80f6551dc784704bc93443d7981052fc">get_record</a> ( rec, s ) ) 
<a name="l00850"></a>00850     {
<a name="l00851"></a>00851       fill_sub_record ( rec_dest, dest, rec, s );
<a name="l00852"></a>00852       <a class="code" href="schema_8c.html#a444fc4fb5a7c13e99feb53df056c02ed">put_record_info</a> (<a class="code" href="pmsg_8h.html#af9e14cbc16deb37f574c22beaa9a48ada0593585da9181e972974c1274d8f2b4f">DEBUG</a>, rec_dest, dest);
<a name="l00853"></a>00853       <a class="code" href="schema_8c.html#a90961f0e8dbd1176d7b0766c8ef23a88">append_record</a> ( rec_dest, dest );
<a name="l00854"></a>00854     }
<a name="l00855"></a>00855 
<a name="l00856"></a>00856   <a class="code" href="schema_8c.html#a1933612db3e4a006afe19cad5ccbcd08">release_record</a> (rec, s);
<a name="l00857"></a>00857   <a class="code" href="schema_8c.html#a1933612db3e4a006afe19cad5ccbcd08">release_record</a> (rec_dest, dest);
<a name="l00858"></a>00858 
<a name="l00859"></a>00859   <span class="keywordflow">return</span> dest-&gt;<a class="code" href="structschema__struct.html#abaea04252495760a93d8d4a3386d0681">tbl</a>;
<a name="l00860"></a>00860 }
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 22 Sep 2015 for Data Management (for INF-2700) by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
